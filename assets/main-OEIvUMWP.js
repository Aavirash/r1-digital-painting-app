(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let r,n,Y=!1,X="brush",p="#FE5F00",x="#000000",f=5,A=!1,L=0,y=0,S=[],I={x:0,y:0,z:0},h=1,k=[],B=4,W=0,T=null,C=!1;const P=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"particles",icon:'<i class="fas fa-sun"></i>',label:"Light Rays"}];function Q(){r=document.getElementById("paintCanvas"),n=r.getContext("2d"),r.width=window.innerWidth,r.height=window.innerHeight,n.lineCap="round",n.lineJoin="round",n.fillStyle=x,n.fillRect(0,0,r.width,r.height),z()}function z(){k.push(n.getImageData(0,0,r.width,r.height)),k.length>20&&k.shift()}function _(){if(k.length>1){k.pop();const t=k[k.length-1];n.putImageData(t,0,0),ee()}}function ee(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function te(){n.fillStyle=x,n.fillRect(0,0,r.width,r.height),z(),w.prevPositions&&(w.prevPositions=[]),S.length=0}function m(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,m.prevX!==null&&m.prevY!==null&&(n.beginPath(),n.moveTo(m.prevX,m.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*h*.5,0,Math.PI*2),n.fill(),m.prevX=t,m.prevY=e}function d(t,e){const o=r.width/2,l=r.height/2,i=12;n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h*.5;for(let a=0;a<i;a++){const s=a*Math.PI*2/i,c=Math.cos(s),u=Math.sin(s),b=o+(t-o)*c-(e-l)*u,M=l+(t-o)*u+(e-l)*c,E=o+(o-b),q=l+(l-M);if(d.prevX!==null&&d.prevY!==null){const G=o+(d.prevX-o)*c-(d.prevY-l)*u,F=l+(d.prevX-o)*u+(d.prevY-l)*c,Z=o+(o-G),j=l+(l-F);n.beginPath(),n.moveTo(G,F),n.lineTo(b,M),n.stroke(),n.beginPath(),n.moveTo(Z,j),n.lineTo(E,q),n.stroke()}n.beginPath(),n.arc(b,M,f*h*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(E,q,f*h*.3,0,Math.PI*2),n.fill()}d.prevX=t,d.prevY=e}function w(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h*.8;const o=r.width/2,l=r.height/2;w.prevPositions||(w.prevPositions=[]);const i=[];for(let a=0;a<B;a++){const s=a*Math.PI*2/B,c=Math.cos(s),u=Math.sin(s),b=o+(t-o)*c-(e-l)*u,M=l+(t-o)*u+(e-l)*c;i.push({x:b,y:M})}w.prevPositions.length===i.length&&Y&&i.forEach((a,s)=>{const c=w.prevPositions[s];n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(a.x,a.y),n.stroke(),n.beginPath(),n.arc(a.x,a.y,f*h*.3,0,Math.PI*2),n.fill()}),w.prevPositions=i}function v(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,v.prevX!==null&&v.prevY!==null&&(n.beginPath(),n.moveTo(v.prevX,v.prevY),n.lineTo(t,e),n.stroke()),v.prevX=t,v.prevY=e}function g(t,e){if(n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,g.prevX!==null&&g.prevY!==null&&(n.beginPath(),n.moveTo(g.prevX,g.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*h*.5,0,Math.PI*2),n.fill(),Math.random()<.1*h){const o=Math.floor(Math.random()*3)+1;for(let l=0;l<o;l++){const i=t+(Math.random()-.5)*f,a=f*(Math.random()*2+1)*h;n.beginPath(),n.moveTo(i,e),n.lineTo(i,e+a),n.stroke()}}g.prevX=t,g.prevY=e}m.prevX=null;m.prevY=null;d.prevX=null;d.prevY=null;w.prevPositions=[];v.prevX=null;v.prevY=null;g.prevX=null;g.prevY=null;function ne(){T||(T=new(window.AudioContext||window.webkitAudioContext))}function oe(t){if(!T)return;const e=T.currentTime;t.forEach((o,l)=>{const i=T.createOscillator(),a=T.createGain();i.connect(a),a.connect(T.destination),i.type="sine",i.frequency.value=o,a.gain.setValueAtTime(.3,e),a.gain.exponentialRampToValueAtTime(.01,e+.5),i.start(e),i.stop(e+.5)})}function ie(t,e){const o=Math.floor(Math.random()*60)+30,l=80+Math.floor(Math.random()*20),i=50+Math.floor(Math.random()*30);return{x:t,y:e,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,size:1+Math.random()*3,color:`hsl(${o}, ${l}%, ${i}%)`,life:1,decay:.02+Math.random()*.03,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2}}function U(t,e,o=8){for(let a=0;a<o;a++)S.push(ie(t+(Math.random()-.5)*30,e+(Math.random()-.5)*30));const l=[[261.63,329.63,392],[293.66,349.23,440],[329.63,392,493.88],[349.23,440,523.25],[392,493.88,587.33],[440,523.25,659.25],[493.88,587.33,698.46]],i=l[Math.floor(Math.random()*l.length)];oe(i)}function le(){for(let e=S.length-1;e>=0;e--){const o=S[e];o.x+=o.vx+I.x*.2,o.y+=o.vy+I.y*.2,o.rotation+=o.rotationSpeed,o.x<-o.size&&(o.x=r.width+o.size),o.x>r.width+o.size&&(o.x=-o.size),o.y<-o.size&&(o.y=r.height+o.size),o.y>r.height+o.size&&(o.y=-o.size),o.vx*=.98,o.vy*=.98,o.life-=o.decay,o.life<=0&&S.splice(e,1)}}function ae(){S.forEach(t=>{n.save(),n.globalAlpha=t.life,n.translate(t.x,t.y),n.rotate(t.rotation);const e=n.createRadialGradient(0,0,0,0,0,t.size);e.addColorStop(0,t.color),e.addColorStop(1,"transparent"),n.fillStyle=e,n.beginPath(),n.arc(0,0,t.size,0,Math.PI*2),n.fill(),n.strokeStyle=t.color,n.lineWidth=1,n.beginPath(),n.moveTo(0,0),n.lineTo(t.size*2,0),n.stroke(),n.restore()}),n.globalAlpha=1}function R(){A=!0,document.getElementById("toolbar").classList.remove("hidden"),D()}function K(){A=!1,document.getElementById("toolbar").classList.add("hidden")}function D(){const t=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(t.forEach((o,l)=>{const s=180/(P.length-1),u=(-90+l*s+L)*Math.PI/180,b=60,M=Math.cos(u)*b,E=Math.sin(u)*b;o.style.transform=`translate(${M}px, ${E}px) scale(${l===y?1.1:1})`,o.classList.toggle("selected",l===y),o.style.transition="all 0.2s ease"}),e){const o=P[y];e.innerHTML=o.icon,e.title=o.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.1s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)}}function V(t){L+=t*15,L>360&&(L-=360),L<-360&&(L+=360),D()}function O(t){if(t<0||t>=P.length)return;switch(y=t,X=P[t].name,D(),X){case"symmetry":B=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"particles":ne();break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)),console.log(`Selected tool: ${P[t].label}`)}function re(){if(typeof PluginMessageHandler<"u"){const t={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(t))}}function $(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===p&&e.classList.add("active")})}function se(){C=!C;const t=document.getElementById("colorPicker"),e=document.querySelector(".color-palette");C?(t.style.display="flex",e.style.display="none"):(t.style.display="none",e.style.display="flex")}function ce(t){x=t,n.fillStyle=x,n.fillRect(0,0,r.width,r.height),z(),C=!1;const e=document.getElementById("colorPicker"),o=document.querySelector(".color-palette");e.style.display="none",o.style.display="flex"}function de(t){Y=!0;const e=r.getBoundingClientRect(),o=t.clientX-e.left,l=t.clientY-e.top;if(X==="particles"){U(o,l,10);return}J(o,l)}function ue(t){if(!Y)return;const e=r.getBoundingClientRect(),o=t.clientX-e.left,l=t.clientY-e.top;if(X==="particles"){Math.random()<.3&&U(o,l,3);return}J(o,l)}function H(){Y&&(Y=!1,z(),m.prevX=null,m.prevY=null,d.prevX=null,d.prevY=null,v.prevX=null,v.prevY=null,g.prevX=null,g.prevY=null)}function J(t,e){switch(X){case"brush":m(t,e);break;case"kaleidoscope":d(t,e);break;case"symmetry":w(t,e);break;case"lines":v(t,e);break;case"drip":g(t,e);break}}function fe(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",i=>{i.accelerationIncludingGravity&&(I.x=i.accelerationIncludingGravity.x||0,I.y=i.accelerationIncludingGravity.y||0,I.z=i.accelerationIncludingGravity.z||0)});let t=0,e=0,o=0,l=15;window.addEventListener("devicemotion",i=>{if(i.accelerationIncludingGravity){const a=i.accelerationIncludingGravity.x||0,s=i.accelerationIncludingGravity.y||0,c=i.accelerationIncludingGravity.z||0,u=Math.abs(a-t),b=Math.abs(s-e),M=Math.abs(c-o);if(t=a,e=s,o=c,X!=="particles"&&(u>l||b>l||M>l)){const E=Date.now();E-W>1e3&&(W=E,te())}}})}window.addEventListener("scrollUp",()=>{R(),y=(y-1+P.length)%P.length,O(y),V(-1)});window.addEventListener("scrollDown",()=>{R(),y=(y+1)%P.length,O(y),V(1)});window.addEventListener("sideClick",()=>{if(P[y].name==="llm"){re();return}A?K():R()});function he(){Q(),fe(),r.addEventListener("mousedown",de),r.addEventListener("mousemove",ue),r.addEventListener("mouseup",H),r.addEventListener("mouseleave",H),r.addEventListener("touchstart",e=>{e.preventDefault();const o=e.touches[0],l=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});r.dispatchEvent(l)}),r.addEventListener("touchmove",e=>{e.preventDefault();const o=e.touches[0],l=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});r.dispatchEvent(l)}),r.addEventListener("touchend",e=>{e.preventDefault();const o=new MouseEvent("mouseup",{});r.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",_),document.getElementById("canvasColorBtn").addEventListener("click",se),document.querySelectorAll(".tool-item").forEach((e,o)=>{e.addEventListener("click",()=>{O(o)})}),document.querySelectorAll(".color-palette .color-swatch").forEach(e=>{e.addEventListener("click",()=>{p=e.dataset.color,$()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(e=>{e.addEventListener("click",()=>{ce(e.dataset.color)})}),$();function t(){le(),ae(),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",he);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");e&&o&&(e.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});let N;document.addEventListener("mousemove",()=>{clearTimeout(N),A&&(N=setTimeout(()=>{K()},3e3))});
