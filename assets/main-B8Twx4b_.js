(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let s,o,S=!1,L="brush",f="#FE5F00",C="#000000",p=5,A=!1,b=0,I=[],X={x:0,y:0,z:0},m=1,k=[],z=4,$=0,T=null,x=!1;const E=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"particles",icon:'<i class="fas fa-spa"></i>',label:"Meditation"}];function j(){s=document.getElementById("paintCanvas"),o=s.getContext("2d"),s.width=window.innerWidth,s.height=window.innerHeight,o.lineCap="round",o.lineJoin="round",o.fillStyle=C,o.fillRect(0,0,s.width,s.height),B()}function B(){k.push(o.getImageData(0,0,s.width,s.height)),k.length>20&&k.shift()}function Q(){if(k.length>1){k.pop();const n=k[k.length-1];o.putImageData(n,0,0),_()}}function _(){const n=document.createElement("div");n.textContent="Undo",n.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(n),setTimeout(()=>{n.remove()},1e3)}function ee(){o.fillStyle=C,o.fillRect(0,0,s.width,s.height),B(),P.prevPositions&&(P.prevPositions=[]),I.length=0}function g(n,e){o.fillStyle=f,o.strokeStyle=f,o.lineWidth=p*m,g.prevX!==null&&g.prevY!==null&&(o.beginPath(),o.moveTo(g.prevX,g.prevY),o.lineTo(n,e),o.stroke()),o.beginPath(),o.arc(n,e,p*m*.5,0,Math.PI*2),o.fill(),g.prevX=n,g.prevY=e}function h(n,e){const t=s.width/2,i=s.height/2,a=12;o.fillStyle=f,o.strokeStyle=f,o.lineWidth=p*m*.5;for(let l=0;l<a;l++){const r=l*Math.PI*2/a,c=Math.cos(r),u=Math.sin(r),d=t+(n-t)*c-(e-i)*u,v=i+(n-t)*u+(e-i)*c,w=t+(t-d),Y=i+(i-v);if(h.prevX!==null&&h.prevY!==null){const O=t+(h.prevX-t)*c-(h.prevY-i)*u,G=i+(h.prevX-t)*u+(h.prevY-i)*c,J=t+(t-O),Z=i+(i-G);o.beginPath(),o.moveTo(O,G),o.lineTo(d,v),o.stroke(),o.beginPath(),o.moveTo(J,Z),o.lineTo(w,Y),o.stroke()}o.beginPath(),o.arc(d,v,p*m*.3,0,Math.PI*2),o.fill(),o.beginPath(),o.arc(w,Y,p*m*.3,0,Math.PI*2),o.fill()}h.prevX=n,h.prevY=e}function P(n,e){o.fillStyle=f,o.strokeStyle=f,o.lineWidth=p*m*.8;const t=s.width/2,i=s.height/2;P.prevPositions||(P.prevPositions=[]);const a=[];for(let l=0;l<z;l++){const r=l*Math.PI*2/z,c=Math.cos(r),u=Math.sin(r),d=t+(n-t)*c-(e-i)*u,v=i+(n-t)*u+(e-i)*c;a.push({x:d,y:v})}P.prevPositions.length===a.length&&S&&a.forEach((l,r)=>{const c=P.prevPositions[r];o.beginPath(),o.moveTo(c.x,c.y),o.lineTo(l.x,l.y),o.stroke(),o.beginPath(),o.arc(l.x,l.y,p*m*.3,0,Math.PI*2),o.fill()}),P.prevPositions=a}function y(n,e){o.fillStyle=f,o.strokeStyle=f,o.lineWidth=p*m,y.prevX!==null&&y.prevY!==null&&(o.beginPath(),o.moveTo(y.prevX,y.prevY),o.lineTo(n,e),o.stroke()),y.prevX=n,y.prevY=e}function M(n,e){if(o.fillStyle=f,o.strokeStyle=f,o.lineWidth=p*m,M.prevX!==null&&M.prevY!==null&&(o.beginPath(),o.moveTo(M.prevX,M.prevY),o.lineTo(n,e),o.stroke()),o.beginPath(),o.arc(n,e,p*m*.5,0,Math.PI*2),o.fill(),Math.random()<.1*m){const t=Math.floor(Math.random()*3)+1;for(let i=0;i<t;i++){const a=n+(Math.random()-.5)*p,l=p*(Math.random()*2+1)*m;o.beginPath(),o.moveTo(a,e),o.lineTo(a,e+l),o.stroke()}}M.prevX=n,M.prevY=e}g.prevX=null;g.prevY=null;h.prevX=null;h.prevY=null;P.prevPositions=[];y.prevX=null;y.prevY=null;M.prevX=null;M.prevY=null;function te(){T||(T=new(window.AudioContext||window.webkitAudioContext))}function F(n,e=1.5){if(!T)return;const t=T.currentTime,i=T.createOscillator(),a=T.createGain();i.connect(a),a.connect(T.destination),i.type="sine",i.frequency.value=n,a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(.3,t+.1),a.gain.exponentialRampToValueAtTime(.01,t+e),i.start(t),i.stop(t+e)}function ne(n,e){const t=Math.floor(Math.random()*360),i=60+Math.floor(Math.random()*40),a=40+Math.floor(Math.random()*40),l=f.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(l){const r=parseInt(l[1],16),c=parseInt(l[2],16),u=parseInt(l[3],16),d=.7,v=Math.floor(r*d+Math.random()*255*(1-d)),w=Math.floor(c*d+Math.random()*255*(1-d)),Y=Math.floor(u*d+Math.random()*255*(1-d));return{x:n,y:e,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,size:2+Math.random()*6,color:`rgb(${v}, ${w}, ${Y})`,life:1,decay:.01+Math.random()*.02,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1}}return{x:n,y:e,vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,size:2+Math.random()*6,color:`hsl(${t}, ${i}%, ${a}%)`,life:1,decay:.01+Math.random()*.02,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1}}function U(n,e,t=8){for(let a=0;a<t;a++)I.push(ne(n+(Math.random()-.5)*40,e+(Math.random()-.5)*40));const i=f.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(i){const a=parseInt(i[1],16),l=parseInt(i[2],16),r=parseInt(i[3],16),c=200+a*.2+l*.3+r*.5;F(c,1.5)}else{const a=[261.63,329.63,392,440,523.25],l=a[Math.floor(Math.random()*a.length)];F(l,1.5)}}function oe(){for(let e=I.length-1;e>=0;e--){const t=I[e];t.x+=t.vx+X.x*.1,t.y+=t.vy+X.y*.1,t.rotation+=t.rotationSpeed,t.x<-t.size&&(t.x=s.width+t.size),t.x>s.width+t.size&&(t.x=-t.size),t.y<-t.size&&(t.y=s.height+t.size),t.y>s.height+t.size&&(t.y=-t.size),t.vx*=.98,t.vy*=.98,t.life-=t.decay,t.life<=0&&I.splice(e,1)}}function ae(){I.forEach(n=>{o.save(),o.globalAlpha=n.life,o.translate(n.x,n.y),o.rotate(n.rotation);const e=o.createRadialGradient(0,0,0,0,0,n.size);e.addColorStop(0,n.color),e.addColorStop(1,"transparent"),o.fillStyle=e,o.beginPath(),o.arc(0,0,n.size,0,Math.PI*2),o.fill(),o.restore()}),o.globalAlpha=1}function D(){A=!0;const n=document.getElementById("pieToolbar");n.classList.remove("hidden"),n.classList.add("visible"),V()}function R(){A=!1;const n=document.getElementById("pieToolbar");n.classList.remove("visible"),n.classList.add("hidden")}function V(){const n=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(n.forEach((t,i)=>{const r=180/(E.length-1),u=(-90+i*r)*Math.PI/180,d=50,v=Math.cos(u)*d,w=Math.sin(u)*d;t.style.transform=`translate(${v}px, ${w}px) scale(${i===b?1.1:1})`,t.classList.toggle("selected",i===b),t.style.transition="all 0.2s ease"}),e){const t=E[b];e.innerHTML=t.icon,e.title=t.label,e.style.transform="translateX(-50%) scale(1.1)",e.style.transition="transform 0.1s ease",setTimeout(()=>{e.style.transform="translateX(-50%) scale(1)"},100)}}function q(n){if(n<0||n>=E.length)return;switch(b=n,L=E[n].name,V(),L){case"symmetry":z=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"particles":te();break}const e=document.getElementById("centerTool");e&&(e.style.transform="translateX(-50%) scale(1.2)",setTimeout(()=>{e.style.transform="translateX(-50%) scale(1)"},100)),console.log(`Selected tool: ${E[n].label}`)}function ie(){if(typeof PluginMessageHandler<"u"){const n={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(n))}}function W(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===f&&e.classList.add("active")})}function le(){x=!x;const n=document.getElementById("colorPicker"),e=document.querySelector(".color-palette");x?(n.style.display="flex",e.style.display="none"):(n.style.display="none",e.style.display="flex")}function se(n){C=n,o.fillStyle=C,o.fillRect(0,0,s.width,s.height),B(),x=!1;const e=document.getElementById("colorPicker"),t=document.querySelector(".color-palette");e.style.display="none",t.style.display="flex"}function re(n){S=!0;const e=s.getBoundingClientRect(),t=n.clientX-e.left,i=n.clientY-e.top;if(L==="particles"){U(t,i,10);return}K(t,i)}function ce(n){if(!S)return;const e=s.getBoundingClientRect(),t=n.clientX-e.left,i=n.clientY-e.top;if(L==="particles"){Math.random()<.3&&U(t,i,3);return}K(t,i)}function H(){S&&(S=!1,B(),g.prevX=null,g.prevY=null,h.prevX=null,h.prevY=null,y.prevX=null,y.prevY=null,M.prevX=null,M.prevY=null)}function K(n,e){switch(L){case"brush":g(n,e);break;case"kaleidoscope":h(n,e);break;case"symmetry":P(n,e);break;case"lines":y(n,e);break;case"drip":M(n,e);break}}function de(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",a=>{a.accelerationIncludingGravity&&(X.x=a.accelerationIncludingGravity.x||0,X.y=a.accelerationIncludingGravity.y||0,X.z=a.accelerationIncludingGravity.z||0)});let n=0,e=0,t=0,i=15;window.addEventListener("devicemotion",a=>{if(a.accelerationIncludingGravity){const l=a.accelerationIncludingGravity.x||0,r=a.accelerationIncludingGravity.y||0,c=a.accelerationIncludingGravity.z||0,u=Math.abs(l-n),d=Math.abs(r-e),v=Math.abs(c-t);if(n=l,e=r,t=c,L!=="particles"&&(u>i||d>i||v>i)){const w=Date.now();w-$>1e3&&($=w,ee())}}})}window.addEventListener("scrollUp",()=>{D(),b=(b-1+E.length)%E.length,q(b)});window.addEventListener("scrollDown",()=>{D(),b=(b+1)%E.length,q(b)});window.addEventListener("sideClick",()=>{if(E[b].name==="llm"){ie();return}A?R():D()});function ue(){j(),de(),s.addEventListener("mousedown",re),s.addEventListener("mousemove",ce),s.addEventListener("mouseup",H),s.addEventListener("mouseleave",H),s.addEventListener("touchstart",e=>{e.preventDefault();const t=e.touches[0],i=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});s.dispatchEvent(i)}),s.addEventListener("touchmove",e=>{e.preventDefault();const t=e.touches[0],i=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});s.dispatchEvent(i)}),s.addEventListener("touchend",e=>{e.preventDefault();const t=new MouseEvent("mouseup",{});s.dispatchEvent(t)}),document.getElementById("undoBtn").addEventListener("click",Q),document.getElementById("canvasColorBtn").addEventListener("click",le),document.getElementById("closeToolbar").addEventListener("click",R),document.querySelectorAll(".tool-item").forEach((e,t)=>{e.addEventListener("click",()=>{q(t)})}),document.querySelectorAll(".color-palette .color-swatch").forEach(e=>{e.addEventListener("click",()=>{f=e.dataset.color,W()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(e=>{e.addEventListener("click",()=>{se(e.dataset.color)})}),W();function n(){oe(),ae(),requestAnimationFrame(n)}n(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",ue);window.handleLLMResponse=function(n){const e=document.getElementById("adviceText"),t=document.getElementById("adviceOverlay");e&&t&&(e.textContent=n,t.style.display="flex",setTimeout(()=>{t.style.display="none"},5e3))};document.addEventListener("click",n=>{const e=document.getElementById("adviceOverlay");e&&n.target===e&&(e.style.display="none")});let N;document.addEventListener("mousemove",()=>{clearTimeout(N),A&&(N=setTimeout(()=>{R()},3e3))});
