(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let r,o,I=!1,b="brush",h="#FE5F00",L="#F2F2F2",u=5,w=0,C=[],S={x:0,y:0,z:0},p=1,T=[],B=4,q=0,k=null,N=0;const M=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"sacred",icon:'<i class="fas fa-spa"></i>',label:"Sacred Geometry"}];function K(){r=document.getElementById("paintCanvas"),o=r.getContext("2d"),r.width=window.innerWidth,r.height=window.innerHeight,o.lineCap="round",o.lineJoin="round",o.fillStyle=L,o.fillRect(0,0,r.width,r.height),X()}function X(){T.push(o.getImageData(0,0,r.width,r.height)),T.length>20&&T.shift()}function V(){if(T.length>1){T.pop();const t=T[T.length-1];o.putImageData(t,0,0),$()}}function $(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function Z(){o.fillStyle=L,o.fillRect(0,0,r.width,r.height),X(),y.prevPositions&&(y.prevPositions=[]),C.length=0}function f(t,e){o.fillStyle=h,o.strokeStyle=h,o.lineWidth=u*p,f.prevX!==null&&f.prevY!==null&&(o.beginPath(),o.moveTo(f.prevX,f.prevY),o.lineTo(t,e),o.stroke()),o.beginPath(),o.arc(t,e,u*p*.5,0,Math.PI*2),o.fill(),f.prevX=t,f.prevY=e}function d(t,e){const n=r.width/2,i=r.height/2,s=12;o.fillStyle=h,o.strokeStyle=h,o.lineWidth=u*p*.5;for(let a=0;a<s;a++){const l=a*Math.PI*2/s,c=Math.cos(l),v=Math.sin(l),P=n+(t-n)*c-(e-i)*v,x=i+(t-n)*v+(e-i)*c,E=n+(n-P),A=i+(i-x);if(d.prevX!==null&&d.prevY!==null){const D=n+(d.prevX-n)*c-(d.prevY-i)*v,R=i+(d.prevX-n)*v+(d.prevY-i)*c,W=n+(n-D),J=i+(i-R);o.beginPath(),o.moveTo(D,R),o.lineTo(P,x),o.stroke(),o.beginPath(),o.moveTo(W,J),o.lineTo(E,A),o.stroke()}o.beginPath(),o.arc(P,x,u*p*.3,0,Math.PI*2),o.fill(),o.beginPath(),o.arc(E,A,u*p*.3,0,Math.PI*2),o.fill()}d.prevX=t,d.prevY=e}function y(t,e){o.fillStyle=h,o.strokeStyle=h,o.lineWidth=u*p*.8;const n=r.width/2,i=r.height/2;y.prevPositions||(y.prevPositions=[]);const s=[];for(let a=0;a<B;a++){const l=a*Math.PI*2/B,c=Math.cos(l),v=Math.sin(l),P=n+(t-n)*c-(e-i)*v,x=i+(t-n)*v+(e-i)*c;s.push({x:P,y:x})}y.prevPositions.length===s.length&&I&&s.forEach((a,l)=>{const c=y.prevPositions[l];o.beginPath(),o.moveTo(c.x,c.y),o.lineTo(a.x,a.y),o.stroke(),o.beginPath(),o.arc(a.x,a.y,u*p*.3,0,Math.PI*2),o.fill()}),y.prevPositions=s}function g(t,e){o.fillStyle=h,o.strokeStyle=h,o.lineWidth=u*p,g.prevX!==null&&g.prevY!==null&&(o.beginPath(),o.moveTo(g.prevX,g.prevY),o.lineTo(t,e),o.stroke()),g.prevX=t,g.prevY=e}function m(t,e){if(o.fillStyle=h,o.strokeStyle=h,o.lineWidth=u*p,m.prevX!==null&&m.prevY!==null&&(o.beginPath(),o.moveTo(m.prevX,m.prevY),o.lineTo(t,e),o.stroke()),o.beginPath(),o.arc(t,e,u*p*.5,0,Math.PI*2),o.fill(),Math.random()<.1*p){const n=Math.floor(Math.random()*3)+1;for(let i=0;i<n;i++){const s=t+(Math.random()-.5)*u,a=u*(Math.random()*2+1)*p;o.beginPath(),o.moveTo(s,e),o.lineTo(s,e+a),o.stroke()}}m.prevX=t,m.prevY=e}f.prevX=null;f.prevY=null;d.prevX=null;d.prevY=null;y.prevPositions=[];g.prevX=null;g.prevY=null;m.prevX=null;m.prevY=null;function j(){k||(k=new(window.AudioContext||window.webkitAudioContext))}function Y(t,e=1.5){if(!k)return;const n=k.currentTime,i=k.createOscillator(),s=k.createGain();i.connect(s),s.connect(k.destination),i.type="sine",i.frequency.value=t,s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(.3,n+.1),s.gain.exponentialRampToValueAtTime(.01,n+e),i.start(n),i.stop(n+e)}function Q(t,e){const n=["circle","triangle","square","pentagon","hexagon","star"],i=n[Math.floor(Math.random()*n.length)];return{x:t,y:e,type:i,size:20+Math.random()*30,color:`hsl(${Math.floor(Math.random()*360)}, 70%, 60%)`,life:1,decay:.01+Math.random()*.01,rotation:Math.random()*Math.PI*2}}function U(t,e){const n=Q(t,e);C.push(n);const s={circle:261.63,triangle:329.63,square:392,pentagon:440,hexagon:523.25,star:659.25}[n.type]||440;Y(s,1.5),N++,N%3===0&&(Y(s*1.25,1.5),Y(s*1.5,1.5))}function _(){for(let e=C.length-1;e>=0;e--){const n=C[e];n.x+=S.x*.05,n.y+=S.y*.05,n.x<-n.size&&(n.x=r.width+n.size),n.x>r.width+n.size&&(n.x=-n.size),n.y<-n.size&&(n.y=r.height+n.size),n.y>r.height+n.size&&(n.y=-n.size),n.life-=n.decay,n.life<=0&&C.splice(e,1)}}function ee(){C.forEach(t=>{switch(o.save(),o.globalAlpha=t.life,o.translate(t.x,t.y),o.rotate(t.rotation),o.strokeStyle=t.color,o.lineWidth=2,o.fillStyle=t.color.replace(")",", 0.2)").replace("hsl","hsla"),t.type){case"circle":o.beginPath(),o.arc(0,0,t.size,0,Math.PI*2),o.stroke(),o.beginPath(),o.arc(0,0,t.size*.5,0,Math.PI*2),o.stroke();break;case"triangle":o.beginPath();for(let e=0;e<3;e++){const n=e*Math.PI*2/3,i=Math.cos(n)*t.size,s=Math.sin(n)*t.size;e===0?o.moveTo(i,s):o.lineTo(i,s)}o.closePath(),o.stroke();break;case"square":o.beginPath(),o.rect(-t.size,-t.size,t.size*2,t.size*2),o.stroke(),o.beginPath(),o.moveTo(-t.size*.7,-t.size*.7),o.lineTo(t.size*.7,t.size*.7),o.moveTo(t.size*.7,-t.size*.7),o.lineTo(-t.size*.7,t.size*.7),o.stroke();break;case"pentagon":o.beginPath();for(let e=0;e<5;e++){const n=e*Math.PI*2/5-Math.PI/2,i=Math.cos(n)*t.size,s=Math.sin(n)*t.size;e===0?o.moveTo(i,s):o.lineTo(i,s)}o.closePath(),o.stroke();break;case"hexagon":o.beginPath();for(let e=0;e<6;e++){const n=e*Math.PI*2/6,i=Math.cos(n)*t.size,s=Math.sin(n)*t.size;e===0?o.moveTo(i,s):o.lineTo(i,s)}o.closePath(),o.stroke();break;case"star":o.beginPath();for(let e=0;e<10;e++){const n=e*Math.PI*2/10-Math.PI/2,i=e%2===0?t.size:t.size*.5,s=Math.cos(n)*i,a=Math.sin(n)*i;e===0?o.moveTo(s,a):o.lineTo(s,a)}o.closePath(),o.stroke();break}o.restore()}),o.globalAlpha=1}function F(){const t=document.getElementById("selectedTool");t&&(t.innerHTML=M[w].icon)}function z(t){if(t>0?w=(w+1)%M.length:w=(w-1+M.length)%M.length,b=M[w].name,F(),b==="llm")te();else switch(b){case"symmetry":B=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"sacred":j();break}console.log(`Selected tool: ${M[w].label}`)}function te(){const t=document.getElementById("selectedTool");if(t){const e=document.createElement("div");if(e.style.cssText=`
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.7);
      animation: ripple 1.5s infinite;
      pointer-events: none;
      z-index: 25;
    `,!document.getElementById("ripple-animation")){const n=document.createElement("style");n.id="ripple-animation",n.textContent=`
        @keyframes ripple {
          0% {
            width: 0;
            height: 0;
            opacity: 1;
          }
          100% {
            width: 100px;
            height: 100px;
            opacity: 0;
          }
        }
      `,document.head.appendChild(n)}t.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1500)}}function oe(){if(typeof PluginMessageHandler<"u"){const e={message:'Give me creative drawing prompts or artistic inspiration in 2-3 sentences. Focus on visual ideas I can draw, like "Draw a tree with colorful leaves" or "Create a pattern of interlocking circles". Be encouraging and artistic.',useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(e))}const t=document.createElement("div");t.textContent="Asking LLM for creative ideas...",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},2e3)}function ne(){const t=document.getElementById("canvasColorPicker"),e=document.getElementById("brushColorPicker");e.style.display==="flex"&&(e.style.display="none"),t.style.display==="flex"?t.style.display="none":(t.style.display="flex",t.querySelectorAll(".color-swatch").forEach(i=>{i.dataset.color===L?i.classList.add("selected-color"):i.classList.remove("selected-color")}))}function ie(){const t=document.getElementById("canvasColorPicker"),e=document.getElementById("brushColorPicker");t.style.display==="flex"&&(t.style.display="none"),e.style.display==="flex"?e.style.display="none":(e.style.display="flex",e.querySelectorAll(".color-swatch").forEach(i=>{i.dataset.color===h?i.classList.add("selected-color"):i.classList.remove("selected-color")}))}function se(t){L=t,o.fillStyle=L,o.fillRect(0,0,r.width,r.height),X(),document.getElementById("canvasColorPicker").style.display="none",console.log("Canvas background color set to:",t)}function ae(t){h=t,document.getElementById("brushColorPicker").style.display="none",console.log("Brush color set to:",t)}function re(t){I=!0;const e=r.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;if(b==="sacred"){U(n,i);return}G(n,i)}function le(t){if(!I)return;const e=r.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;if(b==="sacred"){Math.random()<.3&&U(n,i);return}G(n,i)}function O(){I&&(I=!1,X(),f.prevX=null,f.prevY=null,d.prevX=null,d.prevY=null,g.prevX=null,g.prevY=null,m.prevX=null,m.prevY=null)}function G(t,e){switch(b){case"brush":f(t,e);break;case"kaleidoscope":d(t,e);break;case"symmetry":y(t,e);break;case"lines":g(t,e);break;case"drip":m(t,e);break}}function ce(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",s=>{s.accelerationIncludingGravity&&(S.x=s.accelerationIncludingGravity.x||0,S.y=s.accelerationIncludingGravity.y||0,S.z=s.accelerationIncludingGravity.z||0)});let t=0,e=0,n=0,i=15;window.addEventListener("devicemotion",s=>{if(s.accelerationIncludingGravity){const a=s.accelerationIncludingGravity.x||0,l=s.accelerationIncludingGravity.y||0,c=s.accelerationIncludingGravity.z||0,v=Math.abs(a-t),P=Math.abs(l-e),x=Math.abs(c-n);if(t=a,e=l,n=c,b!=="sacred"&&(v>i||P>i||x>i)){const E=Date.now();E-q>1e3&&(q=E,Z())}}})}window.addEventListener("scrollUp",()=>{z(-1)});window.addEventListener("scrollDown",()=>{z(1)});window.addEventListener("sideClick",()=>{H()});document.addEventListener("keydown",t=>{if(t.key==="ArrowUp"&&(z(-1),t.preventDefault()),t.key==="ArrowDown"&&(z(1),t.preventDefault()),t.key==="Enter"){if(M[w].name==="llm"){oe();return}H(),t.preventDefault()}});function de(){K(),ce(),r.addEventListener("mousedown",re),r.addEventListener("mousemove",le),r.addEventListener("mouseup",O),r.addEventListener("mouseleave",O),r.addEventListener("touchstart",e=>{e.preventDefault();const n=e.touches[0],i=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});r.dispatchEvent(i)}),r.addEventListener("touchmove",e=>{e.preventDefault();const n=e.touches[0],i=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});r.dispatchEvent(i)}),r.addEventListener("touchend",e=>{e.preventDefault();const n=new MouseEvent("mouseup",{});r.dispatchEvent(n)}),document.getElementById("undoBtn").addEventListener("click",V),document.getElementById("canvasColorBtn").addEventListener("click",ne),document.getElementById("eyedropperBtn").addEventListener("click",ie),document.querySelectorAll("#canvasColorPicker .color-swatch").forEach(e=>{e.addEventListener("click",()=>{document.getElementById("canvasColorPicker").querySelectorAll(".color-swatch").forEach(s=>s.classList.remove("selected-color")),e.classList.add("selected-color"),setTimeout(()=>{se(e.dataset.color)},200)})}),document.querySelectorAll("#brushColorPicker .color-swatch").forEach(e=>{e.addEventListener("click",()=>{document.getElementById("brushColorPicker").querySelectorAll(".color-swatch").forEach(s=>s.classList.remove("selected-color")),e.classList.add("selected-color"),setTimeout(()=>{ae(e.dataset.color)},200)})}),F();function t(){_(),ee(),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized with tool:",b)}document.addEventListener("DOMContentLoaded",de);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),n=document.getElementById("adviceOverlay");e&&n&&(e.textContent=t,n.style.display="flex",setTimeout(()=>{n.style.display="none"},5e3))};window.onPluginMessage=function(t){if(console.log("Received plugin message:",t),t&&t.message&&t.message.includes("email")){const e=document.createElement("div");e.textContent=t.message.includes("sent")||t.message.includes("success")?"Email sent successfully!":"Email status: "+t.message,e.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(254, 95, 0, 0.9);
      color: #000;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      z-index: 100;
      pointer-events: none;
    `,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.remove()},3e3)}};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});function H(){const t=r.toDataURL("image/png"),e=document.createElement("div");e.textContent="Processing artwork...",e.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(e),ue(t,e)}async function ue(t,e){try{const n=he(t),i=new FormData;i.append("fileToUpload",n,"artwork.png"),i.append("reqtype","fileupload"),e.textContent="Uploading artwork...",console.log("Starting upload to catbox.moe");const s=await fetch("https://catbox.moe/user/api.php",{method:"POST",body:i});if(!s.ok)throw new Error("Upload failed with status: "+s.status);const a=await s.text();if(console.log("Image uploaded successfully. URL:",a),!a||!a.startsWith("http"))throw new Error("Invalid image URL received from catbox");e.textContent="Sending email...",await pe(a,e)}catch(n){console.error("Error in upload and email process:",n),e&&e.parentNode&&(e.textContent="Upload failed: "+n.message,setTimeout(()=>{e&&e.parentNode&&e.remove()},3e3))}}async function pe(t,e){try{if(console.log("Sending email with image URL:",t),typeof PluginMessageHandler<"u"){const n={message:`Please send this digital artwork as an email attachment to the user's email address. The artwork can be viewed at: ${t}`,imageUrl:t,useLLM:!0,wantsR1Response:!0};console.log("Sending payload to PluginMessageHandler:",n),PluginMessageHandler.postMessage(JSON.stringify(n)),setTimeout(()=>{e&&e.parentNode&&(e.textContent="Email requested successfully!",setTimeout(()=>{e&&e.parentNode&&e.remove()},2e3))},1e3)}else throw new Error("PluginMessageHandler not available - not running in R1 environment")}catch(n){console.error("Error sending email:",n),e&&e.parentNode&&(e.textContent="Email request failed: "+n.message,setTimeout(()=>{e&&e.parentNode&&e.remove()},3e3))}}function he(t){const e=t.split(";base64,"),n=e[0].split(":")[1],i=atob(e[1]),s=new ArrayBuffer(i.length),a=new Uint8Array(s);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return new Blob([s],{type:n})}
