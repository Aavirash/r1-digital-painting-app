(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let l,n,I=!1,P="brush",f="#FE5F00",C="#000000",u=5,g=0,E=[],z={x:0,y:0,z:0},p=1,x=[],B=4,G=0,L=!1,T=null,F=0;const b=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"sacred",icon:'<i class="fas fa-spa"></i>',label:"Sacred Geometry"},{name:"close",icon:'<i class="fas fa-times"></i>',label:"Close"}];function $(){l=document.getElementById("paintCanvas"),n=l.getContext("2d"),l.width=window.innerWidth,l.height=window.innerHeight,n.lineCap="round",n.lineJoin="round",n.fillStyle=C,n.fillRect(0,0,l.width,l.height),A()}function A(){x.push(n.getImageData(0,0,l.width,l.height)),x.length>20&&x.shift()}function Z(){if(x.length>1){x.pop();const t=x[x.length-1];n.putImageData(t,0,0),j()}}function j(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function Q(){n.fillStyle=C,n.fillRect(0,0,l.width,l.height),A(),w.prevPositions&&(w.prevPositions=[]),E.length=0}function h(t,e){n.fillStyle=f,n.strokeStyle=f,n.lineWidth=u*p,h.prevX!==null&&h.prevY!==null&&(n.beginPath(),n.moveTo(h.prevX,h.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,u*p*.5,0,Math.PI*2),n.fill(),h.prevX=t,h.prevY=e}function d(t,e){const o=l.width/2,a=l.height/2,i=12;n.fillStyle=f,n.strokeStyle=f,n.lineWidth=u*p*.5;for(let s=0;s<i;s++){const r=s*Math.PI*2/i,c=Math.cos(r),y=Math.sin(r),k=o+(t-o)*c-(e-a)*y,M=a+(t-o)*y+(e-a)*c,S=o+(o-k),R=a+(a-M);if(d.prevX!==null&&d.prevY!==null){const q=o+(d.prevX-o)*c-(d.prevY-a)*y,O=a+(d.prevX-o)*y+(d.prevY-a)*c,K=o+(o-q),V=a+(a-O);n.beginPath(),n.moveTo(q,O),n.lineTo(k,M),n.stroke(),n.beginPath(),n.moveTo(K,V),n.lineTo(S,R),n.stroke()}n.beginPath(),n.arc(k,M,u*p*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(S,R,u*p*.3,0,Math.PI*2),n.fill()}d.prevX=t,d.prevY=e}function w(t,e){n.fillStyle=f,n.strokeStyle=f,n.lineWidth=u*p*.8;const o=l.width/2,a=l.height/2;w.prevPositions||(w.prevPositions=[]);const i=[];for(let s=0;s<B;s++){const r=s*Math.PI*2/B,c=Math.cos(r),y=Math.sin(r),k=o+(t-o)*c-(e-a)*y,M=a+(t-o)*y+(e-a)*c;i.push({x:k,y:M})}w.prevPositions.length===i.length&&I&&i.forEach((s,r)=>{const c=w.prevPositions[r];n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(s.x,s.y),n.stroke(),n.beginPath(),n.arc(s.x,s.y,u*p*.3,0,Math.PI*2),n.fill()}),w.prevPositions=i}function m(t,e){n.fillStyle=f,n.strokeStyle=f,n.lineWidth=u*p,m.prevX!==null&&m.prevY!==null&&(n.beginPath(),n.moveTo(m.prevX,m.prevY),n.lineTo(t,e),n.stroke()),m.prevX=t,m.prevY=e}function v(t,e){if(n.fillStyle=f,n.strokeStyle=f,n.lineWidth=u*p,v.prevX!==null&&v.prevY!==null&&(n.beginPath(),n.moveTo(v.prevX,v.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,u*p*.5,0,Math.PI*2),n.fill(),Math.random()<.1*p){const o=Math.floor(Math.random()*3)+1;for(let a=0;a<o;a++){const i=t+(Math.random()-.5)*u,s=u*(Math.random()*2+1)*p;n.beginPath(),n.moveTo(i,e),n.lineTo(i,e+s),n.stroke()}}v.prevX=t,v.prevY=e}h.prevX=null;h.prevY=null;d.prevX=null;d.prevY=null;w.prevPositions=[];m.prevX=null;m.prevY=null;v.prevX=null;v.prevY=null;function _(){T||(T=new(window.AudioContext||window.webkitAudioContext))}function D(t,e=1.5){if(!T)return;const o=T.currentTime,a=T.createOscillator(),i=T.createGain();a.connect(i),i.connect(T.destination),a.type="sine",a.frequency.value=t,i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.3,o+.1),i.gain.exponentialRampToValueAtTime(.01,o+e),a.start(o),a.stop(o+e)}function ee(t,e){const o=["circle","triangle","square","pentagon","hexagon","star"],a=o[Math.floor(Math.random()*o.length)];return{x:t,y:e,type:a,size:20+Math.random()*30,color:`hsl(${Math.floor(Math.random()*360)}, 70%, 60%)`,life:1,decay:.01+Math.random()*.01,rotation:Math.random()*Math.PI*2}}function W(t,e){const o=ee(t,e);E.push(o);const i={circle:261.63,triangle:329.63,square:392,pentagon:440,hexagon:523.25,star:659.25}[o.type]||440;D(i,1.5),F++,F%3===0&&(D(i*1.25,1.5),D(i*1.5,1.5))}function te(){for(let e=E.length-1;e>=0;e--){const o=E[e];o.x+=z.x*.05,o.y+=z.y*.05,o.x<-o.size&&(o.x=l.width+o.size),o.x>l.width+o.size&&(o.x=-o.size),o.y<-o.size&&(o.y=l.height+o.size),o.y>l.height+o.size&&(o.y=-o.size),o.life-=o.decay,o.life<=0&&E.splice(e,1)}}function ne(){E.forEach(t=>{switch(n.save(),n.globalAlpha=t.life,n.translate(t.x,t.y),n.rotate(t.rotation),n.strokeStyle=t.color,n.lineWidth=2,n.fillStyle=t.color.replace(")",", 0.2)").replace("hsl","hsla"),t.type){case"circle":n.beginPath(),n.arc(0,0,t.size,0,Math.PI*2),n.stroke(),n.beginPath(),n.arc(0,0,t.size*.5,0,Math.PI*2),n.stroke();break;case"triangle":n.beginPath();for(let e=0;e<3;e++){const o=e*Math.PI*2/3,a=Math.cos(o)*t.size,i=Math.sin(o)*t.size;e===0?n.moveTo(a,i):n.lineTo(a,i)}n.closePath(),n.stroke();break;case"square":n.beginPath(),n.rect(-t.size,-t.size,t.size*2,t.size*2),n.stroke(),n.beginPath(),n.moveTo(-t.size*.7,-t.size*.7),n.lineTo(t.size*.7,t.size*.7),n.moveTo(t.size*.7,-t.size*.7),n.lineTo(-t.size*.7,t.size*.7),n.stroke();break;case"pentagon":n.beginPath();for(let e=0;e<5;e++){const o=e*Math.PI*2/5-Math.PI/2,a=Math.cos(o)*t.size,i=Math.sin(o)*t.size;e===0?n.moveTo(a,i):n.lineTo(a,i)}n.closePath(),n.stroke();break;case"hexagon":n.beginPath();for(let e=0;e<6;e++){const o=e*Math.PI*2/6,a=Math.cos(o)*t.size,i=Math.sin(o)*t.size;e===0?n.moveTo(a,i):n.lineTo(a,i)}n.closePath(),n.stroke();break;case"star":n.beginPath();for(let e=0;e<10;e++){const o=e*Math.PI*2/10-Math.PI/2,a=e%2===0?t.size:t.size*.5,i=Math.cos(o)*a,s=Math.sin(o)*a;e===0?n.moveTo(i,s):n.lineTo(i,s)}n.closePath(),n.stroke();break}n.restore()}),n.globalAlpha=1}function oe(){const t=document.getElementById("selectedTool");t&&(t.innerHTML=b[g].icon)}function X(t){if(t>0?g=(g+1)%b.length:g=(g-1+b.length)%b.length,P=b[g].name,oe(),P==="llm")ie();else if(P!=="close")switch(P){case"symmetry":B=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"sacred":_();break}console.log(`Selected tool: ${b[g].label}`)}function ie(){const t=document.getElementById("selectedTool");if(t){const e=document.createElement("div");if(e.style.cssText=`
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.7);
      animation: ripple 1.5s infinite;
      pointer-events: none;
      z-index: 25;
    `,!document.getElementById("ripple-animation")){const o=document.createElement("style");o.id="ripple-animation",o.textContent=`
        @keyframes ripple {
          0% {
            width: 0;
            height: 0;
            opacity: 1;
          }
          100% {
            width: 100px;
            height: 100px;
            opacity: 0;
          }
        }
      `,document.head.appendChild(o)}t.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1500)}}function U(){if(typeof PluginMessageHandler<"u"){const e={message:'Give me creative drawing prompts or artistic inspiration in 2-3 sentences. Focus on visual ideas I can draw, like "Draw a tree with colorful leaves" or "Create a pattern of interlocking circles". Be encouraging and artistic.',useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(e))}const t=document.createElement("div");t.textContent="Asking LLM for creative ideas...",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},2e3)}function N(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===f&&e.classList.add("active")})}function ae(){L=!L;const t=document.getElementById("colorPicker"),e=document.querySelector(".color-palette");L?(t.style.display="flex",e.style.display="none"):(t.style.display="none",e.style.display="flex")}function le(t){C=t,n.fillStyle=C,n.fillRect(0,0,l.width,l.height),A(),L=!1;const e=document.getElementById("colorPicker"),o=document.querySelector(".color-palette");e.style.display="none",o.style.display="flex"}function se(t){I=!0;const e=l.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top;if(P==="sacred"){W(o,a);return}J(o,a)}function re(t){if(!I)return;const e=l.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top;if(P==="sacred"){Math.random()<.3&&W(o,a);return}J(o,a)}function H(){I&&(I=!1,A(),h.prevX=null,h.prevY=null,d.prevX=null,d.prevY=null,m.prevX=null,m.prevY=null,v.prevX=null,v.prevY=null)}function J(t,e){switch(P){case"brush":h(t,e);break;case"kaleidoscope":d(t,e);break;case"symmetry":w(t,e);break;case"lines":m(t,e);break;case"drip":v(t,e);break}}function ce(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",i=>{i.accelerationIncludingGravity&&(z.x=i.accelerationIncludingGravity.x||0,z.y=i.accelerationIncludingGravity.y||0,z.z=i.accelerationIncludingGravity.z||0)});let t=0,e=0,o=0,a=15;window.addEventListener("devicemotion",i=>{if(i.accelerationIncludingGravity){const s=i.accelerationIncludingGravity.x||0,r=i.accelerationIncludingGravity.y||0,c=i.accelerationIncludingGravity.z||0,y=Math.abs(s-t),k=Math.abs(r-e),M=Math.abs(c-o);if(t=s,e=r,o=c,P!=="sacred"&&(y>a||k>a||M>a)){const S=Date.now();S-G>1e3&&(G=S,Q())}}})}window.addEventListener("scrollUp",()=>{X(-1)});window.addEventListener("scrollDown",()=>{X(1)});window.addEventListener("sideClick",()=>{Y()});document.addEventListener("keydown",t=>{if(t.key==="ArrowUp"&&(X(-1),t.preventDefault()),t.key==="ArrowDown"&&(X(1),t.preventDefault()),t.key==="Enter"){if(b[g].name==="llm"){U();return}Y(),t.preventDefault()}});function de(){$(),ce(),l.addEventListener("mousedown",se),l.addEventListener("mousemove",re),l.addEventListener("mouseup",H),l.addEventListener("mouseleave",H),l.addEventListener("touchstart",e=>{e.preventDefault();const o=e.touches[0],a=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(a)}),l.addEventListener("touchmove",e=>{e.preventDefault();const o=e.touches[0],a=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(a)}),l.addEventListener("touchend",e=>{e.preventDefault();const o=new MouseEvent("mouseup",{});l.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",Z),document.getElementById("canvasColorBtn").addEventListener("click",ae),document.getElementById("selectedTool").addEventListener("click",()=>{b[g].name==="llm"?U():(b[g].name,Y())}),document.querySelectorAll(".color-palette .color-swatch").forEach(e=>{e.addEventListener("click",()=>{f=e.dataset.color,N()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(e=>{e.addEventListener("click",()=>{le(e.dataset.color)})}),N();function t(){te(),ne(),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",de);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");e&&o&&(e.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});function Y(){const t=l.toDataURL("image/png");if(typeof PluginMessageHandler<"u"){const o={message:`Please email this digital artwork to the user's email address: ${t}`,useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(o))}const e=document.createElement("div");e.textContent="Screenshot sent to your email!",e.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(e),setTimeout(()=>{e.remove()},2e3)}
