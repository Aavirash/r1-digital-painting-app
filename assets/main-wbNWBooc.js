(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let s,e,x=!1,I="brush",v="#FE5F00",B="#000000",p=5,u=!1,h=0,L=[],Y={x:0,y:0,z:0},m=1,S=[],O=4,N=0,C=!1,E=null,U=0;const P=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"sacred",icon:'<i class="fas fa-spa"></i>',label:"Sacred Geometry"},{name:"close",icon:'<i class="fas fa-times"></i>',label:"Close"}];function _(){s=document.getElementById("paintCanvas"),e=s.getContext("2d"),s.width=window.innerWidth,s.height=window.innerHeight,e.lineCap="round",e.lineJoin="round",e.fillStyle=B,e.fillRect(0,0,s.width,s.height),R()}function R(){S.push(e.getImageData(0,0,s.width,s.height)),S.length>20&&S.shift()}function ee(){if(S.length>1){S.pop();const t=S[S.length-1];e.putImageData(t,0,0),te()}}function te(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function ne(){e.fillStyle=B,e.fillRect(0,0,s.width,s.height),R(),w.prevPositions&&(w.prevPositions=[]),L.length=0}function g(t,n){e.fillStyle=v,e.strokeStyle=v,e.lineWidth=p*m,g.prevX!==null&&g.prevY!==null&&(e.beginPath(),e.moveTo(g.prevX,g.prevY),e.lineTo(t,n),e.stroke()),e.beginPath(),e.arc(t,n,p*m*.5,0,Math.PI*2),e.fill(),g.prevX=t,g.prevY=n}function d(t,n){const o=s.width/2,l=s.height/2,i=12;e.fillStyle=v,e.strokeStyle=v,e.lineWidth=p*m*.5;for(let a=0;a<i;a++){const c=a*Math.PI*2/i,r=Math.cos(c),k=Math.sin(c),M=o+(t-o)*r-(n-l)*k,T=l+(t-o)*k+(n-l)*r,X=o+(o-M),F=l+(l-T);if(d.prevX!==null&&d.prevY!==null){const W=o+(d.prevX-o)*r-(d.prevY-l)*k,H=l+(d.prevX-o)*k+(d.prevY-l)*r,j=o+(o-W),Q=l+(l-H);e.beginPath(),e.moveTo(W,H),e.lineTo(M,T),e.stroke(),e.beginPath(),e.moveTo(j,Q),e.lineTo(X,F),e.stroke()}e.beginPath(),e.arc(M,T,p*m*.3,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(X,F,p*m*.3,0,Math.PI*2),e.fill()}d.prevX=t,d.prevY=n}function w(t,n){e.fillStyle=v,e.strokeStyle=v,e.lineWidth=p*m*.8;const o=s.width/2,l=s.height/2;w.prevPositions||(w.prevPositions=[]);const i=[];for(let a=0;a<O;a++){const c=a*Math.PI*2/O,r=Math.cos(c),k=Math.sin(c),M=o+(t-o)*r-(n-l)*k,T=l+(t-o)*k+(n-l)*r;i.push({x:M,y:T})}w.prevPositions.length===i.length&&x&&i.forEach((a,c)=>{const r=w.prevPositions[c];e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.stroke(),e.beginPath(),e.arc(a.x,a.y,p*m*.3,0,Math.PI*2),e.fill()}),w.prevPositions=i}function y(t,n){e.fillStyle=v,e.strokeStyle=v,e.lineWidth=p*m,y.prevX!==null&&y.prevY!==null&&(e.beginPath(),e.moveTo(y.prevX,y.prevY),e.lineTo(t,n),e.stroke()),y.prevX=t,y.prevY=n}function b(t,n){if(e.fillStyle=v,e.strokeStyle=v,e.lineWidth=p*m,b.prevX!==null&&b.prevY!==null&&(e.beginPath(),e.moveTo(b.prevX,b.prevY),e.lineTo(t,n),e.stroke()),e.beginPath(),e.arc(t,n,p*m*.5,0,Math.PI*2),e.fill(),Math.random()<.1*m){const o=Math.floor(Math.random()*3)+1;for(let l=0;l<o;l++){const i=t+(Math.random()-.5)*p,a=p*(Math.random()*2+1)*m;e.beginPath(),e.moveTo(i,n),e.lineTo(i,n+a),e.stroke()}}b.prevX=t,b.prevY=n}g.prevX=null;g.prevY=null;d.prevX=null;d.prevY=null;w.prevPositions=[];y.prevX=null;y.prevY=null;b.prevX=null;b.prevY=null;function oe(){E||(E=new(window.AudioContext||window.webkitAudioContext))}function q(t,n=1.5){if(!E)return;const o=E.currentTime,l=E.createOscillator(),i=E.createGain();l.connect(i),i.connect(E.destination),l.type="sine",l.frequency.value=t,i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.3,o+.1),i.gain.exponentialRampToValueAtTime(.01,o+n),l.start(o),l.stop(o+n)}function ie(t,n){const o=["circle","triangle","square","pentagon","hexagon","star"],l=o[Math.floor(Math.random()*o.length)];return{x:t,y:n,type:l,size:20+Math.random()*30,color:`hsl(${Math.floor(Math.random()*360)}, 70%, 60%)`,life:1,decay:.01+Math.random()*.01,rotation:Math.random()*Math.PI*2}}function J(t,n){const o=ie(t,n);L.push(o);const i={circle:261.63,triangle:329.63,square:392,pentagon:440,hexagon:523.25,star:659.25}[o.type]||440;q(i,1.5),U++,U%3===0&&(q(i*1.25,1.5),q(i*1.5,1.5))}function le(){for(let n=L.length-1;n>=0;n--){const o=L[n];o.x+=Y.x*.05,o.y+=Y.y*.05,o.x<-o.size&&(o.x=s.width+o.size),o.x>s.width+o.size&&(o.x=-o.size),o.y<-o.size&&(o.y=s.height+o.size),o.y>s.height+o.size&&(o.y=-o.size),o.life-=o.decay,o.life<=0&&L.splice(n,1)}}function ae(){L.forEach(t=>{switch(e.save(),e.globalAlpha=t.life,e.translate(t.x,t.y),e.rotate(t.rotation),e.strokeStyle=t.color,e.lineWidth=2,e.fillStyle=t.color.replace(")",", 0.2)").replace("hsl","hsla"),t.type){case"circle":e.beginPath(),e.arc(0,0,t.size,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(0,0,t.size*.5,0,Math.PI*2),e.stroke();break;case"triangle":e.beginPath();for(let n=0;n<3;n++){const o=n*Math.PI*2/3,l=Math.cos(o)*t.size,i=Math.sin(o)*t.size;n===0?e.moveTo(l,i):e.lineTo(l,i)}e.closePath(),e.stroke();break;case"square":e.beginPath(),e.rect(-t.size,-t.size,t.size*2,t.size*2),e.stroke(),e.beginPath(),e.moveTo(-t.size*.7,-t.size*.7),e.lineTo(t.size*.7,t.size*.7),e.moveTo(t.size*.7,-t.size*.7),e.lineTo(-t.size*.7,t.size*.7),e.stroke();break;case"pentagon":e.beginPath();for(let n=0;n<5;n++){const o=n*Math.PI*2/5-Math.PI/2,l=Math.cos(o)*t.size,i=Math.sin(o)*t.size;n===0?e.moveTo(l,i):e.lineTo(l,i)}e.closePath(),e.stroke();break;case"hexagon":e.beginPath();for(let n=0;n<6;n++){const o=n*Math.PI*2/6,l=Math.cos(o)*t.size,i=Math.sin(o)*t.size;n===0?e.moveTo(l,i):e.lineTo(l,i)}e.closePath(),e.stroke();break;case"star":e.beginPath();for(let n=0;n<10;n++){const o=n*Math.PI*2/10-Math.PI/2,l=n%2===0?t.size:t.size*.5,i=Math.cos(o)*l,a=Math.sin(o)*l;n===0?e.moveTo(i,a):e.lineTo(i,a)}e.closePath(),e.stroke();break}e.restore()}),e.globalAlpha=1}function A(){u=!0;const t=document.getElementById("toolSelector");t.classList.remove("hidden"),t.classList.add("visible"),Z()}function f(){u=!1;const t=document.getElementById("toolSelector");t.classList.remove("visible"),t.classList.add("hidden")}function Z(){const t=document.getElementById("selectedTool");t&&(t.innerHTML=P[h].icon)}function D(t){switch(t>0?h=(h+1)%P.length:h=(h-1+P.length)%P.length,I=P[h].name,Z(),I){case"symmetry":O=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"sacred":oe();break}console.log(`Selected tool: ${P[h].label}`)}function G(){if(typeof PluginMessageHandler<"u"){const t={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(t))}}function V(){document.querySelectorAll(".color-swatch").forEach(n=>{n.classList.remove("active"),n.dataset.color===v&&n.classList.add("active")})}function se(){C=!C;const t=document.getElementById("colorPicker"),n=document.querySelector(".color-palette");C?(t.style.display="flex",n.style.display="none"):(t.style.display="none",n.style.display="flex")}function ce(t){B=t,e.fillStyle=B,e.fillRect(0,0,s.width,s.height),R(),C=!1;const n=document.getElementById("colorPicker"),o=document.querySelector(".color-palette");n.style.display="none",o.style.display="flex"}function re(t){x=!0;const n=s.getBoundingClientRect(),o=t.clientX-n.left,l=t.clientY-n.top;if(I==="sacred"){J(o,l);return}$(o,l)}function de(t){if(!x)return;const n=s.getBoundingClientRect(),o=t.clientX-n.left,l=t.clientY-n.top;if(I==="sacred"){Math.random()<.3&&J(o,l);return}$(o,l)}function K(){x&&(x=!1,R(),g.prevX=null,g.prevY=null,d.prevX=null,d.prevY=null,y.prevX=null,y.prevY=null,b.prevX=null,b.prevY=null)}function $(t,n){switch(I){case"brush":g(t,n);break;case"kaleidoscope":d(t,n);break;case"symmetry":w(t,n);break;case"lines":y(t,n);break;case"drip":b(t,n);break}}function ue(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",i=>{i.accelerationIncludingGravity&&(Y.x=i.accelerationIncludingGravity.x||0,Y.y=i.accelerationIncludingGravity.y||0,Y.z=i.accelerationIncludingGravity.z||0)});let t=0,n=0,o=0,l=15;window.addEventListener("devicemotion",i=>{if(i.accelerationIncludingGravity){const a=i.accelerationIncludingGravity.x||0,c=i.accelerationIncludingGravity.y||0,r=i.accelerationIncludingGravity.z||0,k=Math.abs(a-t),M=Math.abs(c-n),T=Math.abs(r-o);if(t=a,n=c,o=r,I!=="sacred"&&(k>l||M>l||T>l)){const X=Date.now();X-N>1e3&&(N=X,ne())}}})}window.addEventListener("scrollUp",()=>{u&&(D(-1),clearTimeout(z),z=setTimeout(()=>{u&&f()},3e3))});window.addEventListener("scrollDown",()=>{u&&(D(1),clearTimeout(z),z=setTimeout(()=>{u&&f()},3e3))});window.addEventListener("sideClick",()=>{u?P[h].name==="llm"?(G(),f()):(P[h].name,f()):A()});document.addEventListener("keydown",t=>{if(t.key==="ArrowUp"&&(D(-1),u||A(),setTimeout(()=>{u&&f()},1e3),t.preventDefault()),t.key==="ArrowDown"&&(D(1),u||A(),setTimeout(()=>{u&&f()},1e3),t.preventDefault()),t.key==="Enter"){if(P[h].name==="llm"){G();return}u?f():A(),t.preventDefault()}});function fe(){_(),ue(),s.addEventListener("mousedown",re),s.addEventListener("mousemove",de),s.addEventListener("mouseup",K),s.addEventListener("mouseleave",K),s.addEventListener("touchstart",n=>{n.preventDefault();const o=n.touches[0],l=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});s.dispatchEvent(l)}),s.addEventListener("touchmove",n=>{n.preventDefault();const o=n.touches[0],l=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});s.dispatchEvent(l)}),s.addEventListener("touchend",n=>{n.preventDefault();const o=new MouseEvent("mouseup",{});s.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",ee),document.getElementById("canvasColorBtn").addEventListener("click",se),document.getElementById("closeSelector").addEventListener("click",f),document.getElementById("selectedTool").addEventListener("click",()=>{P[h].name==="llm"?(G(),f()):(P[h].name,f())}),document.querySelectorAll(".color-palette .color-swatch").forEach(n=>{n.addEventListener("click",()=>{v=n.dataset.color,V()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(n=>{n.addEventListener("click",()=>{ce(n.dataset.color)})}),V();function t(){le(),ae(),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",fe);window.handleLLMResponse=function(t){const n=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");n&&o&&(n.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const n=document.getElementById("adviceOverlay");n&&t.target===n&&(n.style.display="none")});let z;document.addEventListener("mousemove",()=>{clearTimeout(z),u&&(z=setTimeout(()=>{f()},3e3))});
