(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(l){if(l.ep)return;l.ep=!0;const a=n(l);fetch(l.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let s,o,Y=!1,b="brush",v="#FE5F00",x="#000000",f=5,T=!1,y=0,I=[],X={x:0,y:0,z:0},h=1,L=[],A=4,F=0,C=!1;const M=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"particles",icon:'<i class="fas fa-sparkles"></i>',label:"Particles"}];function V(){s=document.getElementById("paintCanvas"),o=s.getContext("2d"),s.width=window.innerWidth,s.height=window.innerHeight,o.lineCap="round",o.lineJoin="round",o.fillStyle=x,o.fillRect(0,0,s.width,s.height),D()}function D(){L.push(o.getImageData(0,0,s.width,s.height)),L.length>20&&L.shift()}function j(){if(L.length>1){L.pop();const e=L[L.length-1];o.putImageData(e,0,0),Q()}}function Q(){const e=document.createElement("div");e.textContent="Undo",e.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(e),setTimeout(()=>{e.remove()},1e3)}function _(){o.fillStyle=x,o.fillRect(0,0,s.width,s.height),D(),E.prevPositions&&(E.prevPositions=[]),I.length=0}function p(e,t){o.fillStyle=v,o.strokeStyle=v,o.lineWidth=f*h,p.prevX!==null&&p.prevY!==null&&(o.beginPath(),o.moveTo(p.prevX,p.prevY),o.lineTo(e,t),o.stroke()),o.beginPath(),o.arc(e,t,f*h*.5,0,Math.PI*2),o.fill(),p.prevX=e,p.prevY=t}function d(e,t){const n=s.width/2,i=s.height/2,l=12;o.fillStyle=v,o.strokeStyle=v,o.lineWidth=f*h*.5;for(let a=0;a<l;a++){const r=a*Math.PI*2/l,c=Math.cos(r),u=Math.sin(r),P=n+(e-n)*c-(t-i)*u,w=i+(e-n)*u+(t-i)*c,k=n+(n-P),O=i+(i-w);if(d.prevX!==null&&d.prevY!==null){const q=n+(d.prevX-n)*c-(d.prevY-i)*u,G=i+(d.prevX-n)*u+(d.prevY-i)*c,J=n+(n-q),Z=i+(i-G);o.beginPath(),o.moveTo(q,G),o.lineTo(P,w),o.stroke(),o.beginPath(),o.moveTo(J,Z),o.lineTo(k,O),o.stroke()}o.beginPath(),o.arc(P,w,f*h*.3,0,Math.PI*2),o.fill(),o.beginPath(),o.arc(k,O,f*h*.3,0,Math.PI*2),o.fill()}d.prevX=e,d.prevY=t}function E(e,t){o.fillStyle=v,o.strokeStyle=v,o.lineWidth=f*h*.8;const n=s.width/2,i=s.height/2;E.prevPositions||(E.prevPositions=[]);const l=[];for(let a=0;a<A;a++){const r=a*Math.PI*2/A,c=Math.cos(r),u=Math.sin(r),P=n+(e-n)*c-(t-i)*u,w=i+(e-n)*u+(t-i)*c;l.push({x:P,y:w})}E.prevPositions.length===l.length&&Y&&l.forEach((a,r)=>{const c=E.prevPositions[r];o.beginPath(),o.moveTo(c.x,c.y),o.lineTo(a.x,a.y),o.stroke(),o.beginPath(),o.arc(a.x,a.y,f*h*.3,0,Math.PI*2),o.fill()}),E.prevPositions=l}function m(e,t){o.fillStyle=v,o.strokeStyle=v,o.lineWidth=f*h,m.prevX!==null&&m.prevY!==null&&(o.beginPath(),o.moveTo(m.prevX,m.prevY),o.lineTo(e,t),o.stroke()),m.prevX=e,m.prevY=t}function g(e,t){if(o.fillStyle=v,o.strokeStyle=v,o.lineWidth=f*h,g.prevX!==null&&g.prevY!==null&&(o.beginPath(),o.moveTo(g.prevX,g.prevY),o.lineTo(e,t),o.stroke()),o.beginPath(),o.arc(e,t,f*h*.5,0,Math.PI*2),o.fill(),Math.random()<.1*h){const n=Math.floor(Math.random()*3)+1;for(let i=0;i<n;i++){const l=e+(Math.random()-.5)*f,a=f*(Math.random()*2+1)*h;o.beginPath(),o.moveTo(l,t),o.lineTo(l,t+a),o.stroke()}}g.prevX=e,g.prevY=t}p.prevX=null;p.prevY=null;d.prevX=null;d.prevY=null;E.prevPositions=[];m.prevX=null;m.prevY=null;g.prevX=null;g.prevY=null;function ee(e,t){const n=Math.floor(Math.random()*360),i=70+Math.floor(Math.random()*30),l=60+Math.floor(Math.random()*30);return{x:e,y:t,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,size:3+Math.random()*5,color:`hsl(${n}, ${i}%, ${l}%)`,life:1,decay:.02+Math.random()*.02,shine:Math.random()*.5+.5}}function U(e,t,n=10){for(let i=0;i<n;i++)I.push(ee(e+(Math.random()-.5)*30,t+(Math.random()-.5)*30))}function te(){for(let t=I.length-1;t>=0;t--){const n=I[t];n.x+=n.vx+X.x*.15,n.y+=n.vy+X.y*.15,n.x<-n.size&&(n.x=s.width+n.size),n.x>s.width+n.size&&(n.x=-n.size),n.y<-n.size&&(n.y=s.height+n.size),n.y>s.height+n.size&&(n.y=-n.size),n.vx*=.98,n.vy*=.98,n.life-=n.decay,n.life<=0&&I.splice(t,1)}}function ne(){I.forEach(e=>{o.save(),o.globalAlpha=e.life;const t=o.createRadialGradient(e.x-e.size*.3,e.y-e.size*.3,0,e.x,e.y,e.size);t.addColorStop(0,`rgba(255, 255, 255, ${e.shine})`),t.addColorStop(.3,e.color),t.addColorStop(1,"transparent"),o.fillStyle=t,o.beginPath(),o.arc(e.x,e.y,e.size,0,Math.PI*2),o.fill(),o.restore()}),o.globalAlpha=1}function S(){T=!0;const e=document.getElementById("rotatingMenu");e.classList.remove("hidden"),e.classList.add("visible"),R()}function B(){T=!1;const e=document.getElementById("rotatingMenu");e.classList.remove("visible"),e.classList.add("hidden")}function R(){const e=document.querySelectorAll(".tool-item"),t=document.getElementById("centerIndicator");if(e.forEach((n,i)=>{const r=180/(M.length-1),u=(-90+i*r)*Math.PI/180,P=75,w=Math.cos(u)*P,k=Math.sin(u)*P;n.style.transform=`translate(${w}px, ${k}px) scale(${i===y?1.1:1})`,n.classList.toggle("selected",i===y)}),t){const n=M[y];t.innerHTML=n.icon}}function z(e){switch(e>0?y=(y+1)%M.length:y=(y-1+M.length)%M.length,b=M[y].name,R(),b){case"symmetry":A=4;break}}function oe(e){if(!(e<0||e>=M.length)){switch(y=e,b=M[e].name,R(),b){case"symmetry":A=4;break}console.log(`Selected tool: ${M[e].label}`)}}function N(){if(typeof PluginMessageHandler<"u"){const e={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(e))}}function $(){document.querySelectorAll(".color-swatch").forEach(t=>{t.classList.remove("active"),t.dataset.color===v&&t.classList.add("active")})}function ie(){C=!C;const e=document.getElementById("colorPicker"),t=document.querySelector(".color-palette");C?(e.style.display="flex",t.style.display="none"):(e.style.display="none",t.style.display="flex")}function le(e){x=e,o.fillStyle=x,o.fillRect(0,0,s.width,s.height),D(),C=!1;const t=document.getElementById("colorPicker"),n=document.querySelector(".color-palette");t.style.display="none",n.style.display="flex"}function se(e){Y=!0;const t=s.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;if(b==="particles"){U(n,i,10);return}K(n,i)}function ae(e){if(!Y)return;const t=s.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;if(b==="particles"){Math.random()<.3&&U(n,i,3);return}K(n,i)}function W(){Y&&(Y=!1,D(),p.prevX=null,p.prevY=null,d.prevX=null,d.prevY=null,m.prevX=null,m.prevY=null,g.prevX=null,g.prevY=null)}function K(e,t){switch(b){case"brush":p(e,t);break;case"kaleidoscope":d(e,t);break;case"symmetry":E(e,t);break;case"lines":m(e,t);break;case"drip":g(e,t);break}}function re(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",l=>{l.accelerationIncludingGravity&&(X.x=l.accelerationIncludingGravity.x||0,X.y=l.accelerationIncludingGravity.y||0,X.z=l.accelerationIncludingGravity.z||0)});let e=0,t=0,n=0,i=15;window.addEventListener("devicemotion",l=>{if(l.accelerationIncludingGravity){const a=l.accelerationIncludingGravity.x||0,r=l.accelerationIncludingGravity.y||0,c=l.accelerationIncludingGravity.z||0,u=Math.abs(a-e),P=Math.abs(r-t),w=Math.abs(c-n);if(e=a,t=r,n=c,b!=="particles"&&(u>i||P>i||w>i)){const k=Date.now();k-F>1e3&&(F=k,_())}}})}window.addEventListener("scrollUp",()=>{S(),z(-1)});window.addEventListener("scrollDown",()=>{S(),z(1)});window.addEventListener("sideClick",()=>{if(M[y].name==="llm"){N();return}T?B():S()});document.addEventListener("keydown",e=>{if(e.key==="ArrowUp"&&(S(),z(-1),e.preventDefault()),e.key==="ArrowDown"&&(S(),z(1),e.preventDefault()),e.key==="Enter"){if(M[y].name==="llm"){N();return}T?B():S(),e.preventDefault()}});function ce(){V(),re(),s.addEventListener("mousedown",se),s.addEventListener("mousemove",ae),s.addEventListener("mouseup",W),s.addEventListener("mouseleave",W),s.addEventListener("touchstart",t=>{t.preventDefault();const n=t.touches[0],i=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});s.dispatchEvent(i)}),s.addEventListener("touchmove",t=>{t.preventDefault();const n=t.touches[0],i=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});s.dispatchEvent(i)}),s.addEventListener("touchend",t=>{t.preventDefault();const n=new MouseEvent("mouseup",{});s.dispatchEvent(n)}),document.getElementById("undoBtn").addEventListener("click",j),document.getElementById("canvasColorBtn").addEventListener("click",ie),document.getElementById("closeMenu").addEventListener("click",B),document.querySelectorAll(".tool-item").forEach((t,n)=>{t.addEventListener("click",()=>{oe(n)})}),document.querySelectorAll(".color-palette .color-swatch").forEach(t=>{t.addEventListener("click",()=>{v=t.dataset.color,$()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(t=>{t.addEventListener("click",()=>{le(t.dataset.color)})}),$();function e(){te(),ne(),requestAnimationFrame(e)}e(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",ce);window.handleLLMResponse=function(e){const t=document.getElementById("adviceText"),n=document.getElementById("adviceOverlay");t&&n&&(t.textContent=e,n.style.display="flex",setTimeout(()=>{n.style.display="none"},5e3))};document.addEventListener("click",e=>{const t=document.getElementById("adviceOverlay");t&&e.target===t&&(t.style.display="none")});let H;document.addEventListener("mousemove",()=>{clearTimeout(H),T&&(H=setTimeout(()=>{B()},3e3))});
