(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let s,n,I=!1,x="brush",p="#FE5F00",A="#000000",f=5,z=!0,k=0,b=0,X=[],L={x:0,y:0,z:0},h=1,Y=[],C=4,q=0,T=null;const P=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"particles",icon:'<i class="fas fa-sparkles"></i>',label:"Particles"}];function V(){s=document.getElementById("paintCanvas"),n=s.getContext("2d"),s.width=240,s.height=230,n.lineCap="round",n.lineJoin="round",n.fillStyle=A,n.fillRect(0,0,s.width,s.height),S()}function S(){Y.push(n.getImageData(0,0,s.width,s.height)),Y.length>20&&Y.shift()}function J(){if(Y.length>1){Y.pop();const t=Y[Y.length-1];n.putImageData(t,0,0),Z()}}function Z(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function j(){if(confirm("Clear entire canvas? This cannot be undone.")){const t=s.width/2,e=s.height/2,o=Math.sqrt(t**2+e**2);let a=0;const i=()=>{n.globalCompositeOperation="destination-out",n.beginPath(),n.arc(t,e,a,0,Math.PI*2),n.fill(),n.globalCompositeOperation="source-over",a+=20,a<o+20?requestAnimationFrame(i):(n.fillStyle=A,n.fillRect(0,0,s.width,s.height),S(),y.prevPositions&&(y.prevPositions=[]))};i()}}function Q(){n.fillStyle=A,n.fillRect(0,0,s.width,s.height),S(),y.prevPositions&&(y.prevPositions=[]),X.length=0;const t=document.createElement("div");t.textContent="Reset",t.style.cssText=`
    position: fixed;
    top: 60px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1500)}function m(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,m.prevX!==null&&m.prevY!==null&&(n.beginPath(),n.moveTo(m.prevX,m.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*h*.5,0,Math.PI*2),n.fill(),m.prevX=t,m.prevY=e}function d(t,e){const o=s.width/2,a=s.height/2,i=12;n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h*.5;for(let l=0;l<i;l++){const r=l*Math.PI*2/i,c=Math.cos(r),u=Math.sin(r),w=o+(t-o)*c-(e-a)*u,M=a+(t-o)*u+(e-a)*c,E=o+(o-w),D=a+(a-M);if(d.prevX!==null&&d.prevY!==null){const O=o+(d.prevX-o)*c-(d.prevY-a)*u,G=a+(d.prevX-o)*u+(d.prevY-a)*c,U=o+(o-O),K=a+(a-G);n.beginPath(),n.moveTo(O,G),n.lineTo(w,M),n.stroke(),n.beginPath(),n.moveTo(U,K),n.lineTo(E,D),n.stroke()}n.beginPath(),n.arc(w,M,f*h*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(E,D,f*h*.3,0,Math.PI*2),n.fill()}d.prevX=t,d.prevY=e}function y(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h*.8;const o=s.width/2,a=s.height/2;y.prevPositions||(y.prevPositions=[]);const i=[];for(let l=0;l<C;l++){const r=l*Math.PI*2/C,c=Math.cos(r),u=Math.sin(r),w=o+(t-o)*c-(e-a)*u,M=a+(t-o)*u+(e-a)*c;i.push({x:w,y:M})}y.prevPositions.length===i.length&&I&&i.forEach((l,r)=>{const c=y.prevPositions[r];n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(l.x,l.y),n.stroke(),n.beginPath(),n.arc(l.x,l.y,f*h*.3,0,Math.PI*2),n.fill()}),y.prevPositions=i}function v(t,e){n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,v.prevX!==null&&v.prevY!==null&&(n.beginPath(),n.moveTo(v.prevX,v.prevY),n.lineTo(t,e),n.stroke()),v.prevX=t,v.prevY=e}function g(t,e){if(n.fillStyle=p,n.strokeStyle=p,n.lineWidth=f*h,g.prevX!==null&&g.prevY!==null&&(n.beginPath(),n.moveTo(g.prevX,g.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*h*.5,0,Math.PI*2),n.fill(),Math.random()<.1*h){const o=Math.floor(Math.random()*3)+1;for(let a=0;a<o;a++){const i=t+(Math.random()-.5)*f,l=f*(Math.random()*2+1)*h;n.beginPath(),n.moveTo(i,e),n.lineTo(i,e+l),n.stroke()}}g.prevX=t,g.prevY=e}m.prevX=null;m.prevY=null;d.prevX=null;d.prevY=null;y.prevPositions=[];v.prevX=null;v.prevY=null;g.prevX=null;g.prevY=null;function _(){T||(T=new(window.AudioContext||window.webkitAudioContext))}function ee(t){if(!T)return;const e=T.currentTime;t.forEach((o,a)=>{const i=T.createOscillator(),l=T.createGain();i.connect(l),l.connect(T.destination),i.type="sine",i.frequency.value=o,l.gain.setValueAtTime(.3,e),l.gain.exponentialRampToValueAtTime(.01,e+.5),i.start(e),i.stop(e+.5)})}function te(t,e){const o=Math.floor(Math.random()*360),a=70+Math.floor(Math.random()*30),i=50+Math.floor(Math.random()*50);return{x:t,y:e,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,size:2+Math.random()*8,color:`hsl(${o}, ${a}%, ${i}%)`,life:1,decay:.01+Math.random()*.02,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1}}function N(t,e,o=5){for(let l=0;l<o;l++)X.push(te(t+(Math.random()-.5)*20,e+(Math.random()-.5)*20));const a=[[261.63,329.63,392],[293.66,349.23,440],[329.63,392,493.88],[349.23,440,523.25],[392,493.88,587.33],[440,523.25,659.25],[493.88,587.33,698.46]],i=a[Math.floor(Math.random()*a.length)];ee(i)}function ne(){for(let e=X.length-1;e>=0;e--){const o=X[e];o.x+=o.vx+L.x*.1,o.y+=o.vy+L.y*.1,o.rotation+=o.rotationSpeed,o.x<-o.size&&(o.x=s.width+o.size),o.x>s.width+o.size&&(o.x=-o.size),o.y<-o.size&&(o.y=s.height+o.size),o.y>s.height+o.size&&(o.y=-o.size),o.vx*=.98,o.vy*=.98,o.life-=o.decay,o.life<=0&&X.splice(e,1)}}function oe(){X.forEach(t=>{n.save(),n.globalAlpha=t.life,n.translate(t.x,t.y),n.rotate(t.rotation);const e=n.createRadialGradient(0,0,0,0,0,t.size);e.addColorStop(0,t.color),e.addColorStop(1,"transparent"),n.fillStyle=e,n.beginPath(),n.arc(0,0,t.size,0,Math.PI*2),n.fill(),n.restore()}),n.globalAlpha=1}function ie(){z=!0;const t=document.getElementById("toolbar");t.style.transform="translateY(0)",R()}function ae(){z=!1;const t=document.getElementById("toolbar");t.style.transform="translateY(0)"}function R(){const t=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(t.forEach((o,a)=>{const r=180/(P.length-1),u=(-90+a*r+k)*Math.PI/180,w=35,M=Math.cos(u)*w,E=Math.sin(u)*w;o.style.transform=`translate(${M}px, ${E}px) scale(${a===b?1.1:1})`,o.classList.toggle("selected",a===b),o.style.transition="all 0.2s ease"}),e){const o=P[b];e.innerHTML=o.icon,e.title=o.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.1s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)}}function W(t){k+=t*15,k>360&&(k-=360),k<-360&&(k+=360),R()}function B(t){if(t<0||t>=P.length)return;switch(b=t,x=P[t].name,R(),x){case"symmetry":C=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"particles":_();break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)),console.log(`Selected tool: ${P[t].label}`)}function le(){if(typeof PluginMessageHandler<"u"){const t={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(t))}}function F(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===p&&e.classList.add("active")})}function se(t){I=!0;const e=s.getBoundingClientRect(),o=(t.clientX-e.left)*(s.width/e.width),a=(t.clientY-e.top)*(s.height/e.height);if(x==="particles"){N(o,a,10);return}H(o,a)}function re(t){if(!I)return;const e=s.getBoundingClientRect(),o=(t.clientX-e.left)*(s.width/e.width),a=(t.clientY-e.top)*(s.height/e.height);if(x==="particles"){Math.random()<.3&&N(o,a,3);return}H(o,a)}function $(){I&&(I=!1,S(),m.prevX=null,m.prevY=null,d.prevX=null,d.prevY=null,v.prevX=null,v.prevY=null,g.prevX=null,g.prevY=null)}function H(t,e){switch(x){case"brush":m(t,e);break;case"kaleidoscope":d(t,e);break;case"symmetry":y(t,e);break;case"lines":v(t,e);break;case"drip":g(t,e);break}}function ce(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",i=>{i.accelerationIncludingGravity&&(L.x=i.accelerationIncludingGravity.x||0,L.y=i.accelerationIncludingGravity.y||0,L.z=i.accelerationIncludingGravity.z||0)});let t=0,e=0,o=0,a=15;window.addEventListener("devicemotion",i=>{if(i.accelerationIncludingGravity){const l=i.accelerationIncludingGravity.x||0,r=i.accelerationIncludingGravity.y||0,c=i.accelerationIncludingGravity.z||0,u=Math.abs(l-t),w=Math.abs(r-e),M=Math.abs(c-o);if(t=l,e=r,o=c,x!=="particles"&&(u>a||w>a||M>a)){const E=Date.now();E-q>1e3&&(q=E,j())}}})}window.addEventListener("scrollUp",()=>{b=(b-1+P.length)%P.length,B(b),W(-1)});window.addEventListener("scrollDown",()=>{b=(b+1)%P.length,B(b),W(1)});window.addEventListener("sideClick",()=>{if(P[b].name==="llm"){le();return}z?ae():ie()});function de(){V(),ce(),s.addEventListener("mousedown",se),s.addEventListener("mousemove",re),s.addEventListener("mouseup",$),s.addEventListener("mouseleave",$),s.addEventListener("touchstart",e=>{e.preventDefault();const o=e.touches[0],a=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});s.dispatchEvent(a)}),s.addEventListener("touchmove",e=>{e.preventDefault();const o=e.touches[0],a=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});s.dispatchEvent(a)}),s.addEventListener("touchend",e=>{e.preventDefault();const o=new MouseEvent("mouseup",{});s.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",J),document.getElementById("resetBtn").addEventListener("click",Q),document.querySelectorAll(".tool-item").forEach((e,o)=>{e.addEventListener("click",()=>{B(o)})}),document.querySelectorAll(".color-swatch").forEach(e=>{e.addEventListener("click",()=>{p=e.dataset.color,F()})}),F();function t(){ne(),oe(),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",de);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");e&&o&&(e.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});
