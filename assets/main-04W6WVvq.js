(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let l,n,k=!1,S="brush",u="#FE5F00",B="#000000",f=5,Y=!1,T=0,g=0,L=[],d=1,b=[],D=4;const M=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"canvascolor",icon:'<i class="fas fa-palette"></i>',label:"Canvas Color"}];function K(){l=document.getElementById("paintCanvas"),n=l.getContext("2d"),l.width=240,l.height=230,n.lineCap="round",n.lineJoin="round",n.fillStyle=B,n.fillRect(0,0,l.width,l.height),A()}function A(){b.push(n.getImageData(0,0,l.width,l.height)),b.length>20&&b.shift()}function J(){if(b.length>1){b.pop();const t=b[b.length-1];n.putImageData(t,0,0),V()}}function V(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 2vw 4vw;
    border-radius: 2vw;
    font-size: 4vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function j(){n.fillStyle=B,n.fillRect(0,0,l.width,l.height),A(),w.prevPositions&&(w.prevPositions=[]),L.length=0;const t=document.createElement("div");t.textContent="Reset",t.style.cssText=`
    position: fixed;
    top: 20%;
    right: 4vw;
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 2vw 3vw;
    border-radius: 2vw;
    font-size: 3vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1500)}function v(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=f*d,v.prevX!==null&&v.prevY!==null&&(n.beginPath(),n.moveTo(v.prevX,v.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*d*.5,0,Math.PI*2),n.fill(),v.prevX=t,v.prevY=e}function c(t,e){const o=l.width/2,i=l.height/2,s=12;n.fillStyle=u,n.strokeStyle=u,n.lineWidth=f*d*.5;for(let a=0;a<s;a++){const r=a*Math.PI*2/s,h=Math.cos(r),y=Math.sin(r),P=o+(t-o)*h-(e-i)*y,E=i+(t-o)*y+(e-i)*h,C=o+(o-P),R=i+(i-E);if(c.prevX!==null&&c.prevY!==null){const O=o+(c.prevX-o)*h-(c.prevY-i)*y,$=i+(c.prevX-o)*y+(c.prevY-i)*h,G=o+(o-O),U=i+(i-$);n.beginPath(),n.moveTo(O,$),n.lineTo(P,E),n.stroke(),n.beginPath(),n.moveTo(G,U),n.lineTo(C,R),n.stroke()}n.beginPath(),n.arc(P,E,f*d*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(C,R,f*d*.3,0,Math.PI*2),n.fill()}c.prevX=t,c.prevY=e}function w(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=f*d*.8;const o=l.width/2,i=l.height/2;w.prevPositions||(w.prevPositions=[]);const s=[];for(let a=0;a<D;a++){const r=a*Math.PI*2/D,h=Math.cos(r),y=Math.sin(r),P=o+(t-o)*h-(e-i)*y,E=i+(t-o)*y+(e-i)*h;s.push({x:P,y:E})}w.prevPositions.length===s.length&&k&&s.forEach((a,r)=>{const h=w.prevPositions[r];n.beginPath(),n.moveTo(h.x,h.y),n.lineTo(a.x,a.y),n.stroke(),n.beginPath(),n.arc(a.x,a.y,f*d*.3,0,Math.PI*2),n.fill()}),w.prevPositions=s}function m(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=f*d,m.prevX!==null&&m.prevY!==null&&(n.beginPath(),n.moveTo(m.prevX,m.prevY),n.lineTo(t,e),n.stroke()),m.prevX=t,m.prevY=e}function p(t,e){if(n.fillStyle=u,n.strokeStyle=u,n.lineWidth=f*d,p.prevX!==null&&p.prevY!==null&&(n.beginPath(),n.moveTo(p.prevX,p.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,f*d*.5,0,Math.PI*2),n.fill(),Math.random()<.1*d){const o=Math.floor(Math.random()*3)+1;for(let i=0;i<o;i++){const s=t+(Math.random()-.5)*f,a=f*(Math.random()*2+1)*d;n.beginPath(),n.moveTo(s,e),n.lineTo(s,e+a),n.stroke()}}p.prevX=t,p.prevY=e}v.prevX=null;v.prevY=null;c.prevX=null;c.prevY=null;w.prevPositions=[];m.prevX=null;m.prevY=null;p.prevX=null;p.prevY=null;function Q(t,e,o="simple"){return{x:t,y:e,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:Math.random()*2+1,color:u,life:1,decay:Math.random()*.05+.02,type:o}}function Z(){for(let t=L.length-1;t>=0;t--){const e=L[t];e.x+=e.vx,e.y+=e.vy,e.vy+=.05,(e.x<=e.size||e.x>=l.width-e.size)&&(e.vx*=-.8,e.x=Math.max(e.size,Math.min(l.width-e.size,e.x))),(e.y<=e.size||e.y>=l.height-e.size)&&(e.vy*=-.8,e.y=Math.max(e.size,Math.min(l.height-e.size,e.y))),e.vx*=.98,e.vy*=.98,e.life-=e.decay,(e.life<=0||e.size<=.1)&&L.splice(t,1)}}function _(){L.forEach(t=>{n.globalAlpha=t.life,n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,t.size,0,Math.PI*2),n.fill()}),n.globalAlpha=1}function N(t,e,o=3){for(let i=0;i<o*d;i++)L.push(Q(t+(Math.random()-.5)*5,e+(Math.random()-.5)*5,"simple"))}function I(){Y=!0;const t=document.getElementById("toolbar");t.style.transform="translateY(0)",z(),clearTimeout(window.toolbarHideTimeout),window.toolbarHideTimeout=setTimeout(()=>{Y&&X()},3e3)}function X(){Y=!1;const t=document.getElementById("toolbar");t.style.transform="translateY(100%)",clearTimeout(window.toolbarHideTimeout)}function z(){const t=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(t.forEach((o,i)=>{const r=180/(M.length-1),y=(-90+i*r+T)*Math.PI/180,P=20,E=Math.cos(y)*P,C=Math.sin(y)*P;o.style.transform=`translate(${E}vw, ${C}vw) scale(${i===g?1.1:1})`,o.classList.toggle("selected",i===g),o.style.transition="all 0.2s ease"}),e){const o=M[g];e.innerHTML=o.icon,e.title=o.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.1s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)}}function W(t){T+=t*15,T>360&&(T-=360),T<-360&&(T+=360),z()}function x(t){if(t<0||t>=M.length)return;switch(g=t,S=M[t].name,z(),S){case"symmetry":D=4;break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)),console.log(`Selected tool: ${M[t].label}`)}function ee(){if(typeof PluginMessageHandler<"u"){const t={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(t))}}function q(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===u&&e.classList.add("active")})}function te(){const t=["#000000","#1a1a2e","#2a2a4a","#4a4a6a","#6a6a8a","#8a8aa8","#aaaaa8","#ffffff"],e=["Black","Dark Blue","Dark Gray","Gray","Light Gray","Light Blue","Light Gray","White"];let o="";t.forEach((s,a)=>{o+=`${a+1}. ${e[a]} (${s})
`});const i=prompt(`Choose canvas background color:
${o}
Enter number (1-8):`);if(i&&!isNaN(i)&&i>=1&&i<=8){const s=parseInt(i)-1;if(B=t[s],n.fillStyle=B,n.fillRect(0,0,l.width,l.height),b.length>0){const a=b[b.length-1];n.putImageData(a,0,0)}A()}}function ne(t){k=!0;const e=l.getBoundingClientRect(),o=(t.clientX-e.left)*(l.width/e.width),i=(t.clientY-e.top)*(l.height/e.height);S==="drip"&&N(o,i,1),F(o,i)}function oe(t){if(!k)return;const e=l.getBoundingClientRect(),o=(t.clientX-e.left)*(l.width/e.width),i=(t.clientY-e.top)*(l.height/e.height);S==="drip"&&Math.random()<.3&&N(o,i,1),F(o,i)}function H(){k&&(k=!1,A(),v.prevX=null,v.prevY=null,c.prevX=null,c.prevY=null,m.prevX=null,m.prevY=null,p.prevX=null,p.prevY=null)}function F(t,e){switch(S){case"brush":v(t,e);break;case"kaleidoscope":c(t,e);break;case"symmetry":w(t,e);break;case"lines":m(t,e);break;case"drip":p(t,e);break}}window.addEventListener("scrollUp",()=>{Y&&(g=(g-1+M.length)%M.length,x(g),W(-1)),I()});window.addEventListener("scrollDown",()=>{Y&&(g=(g+1)%M.length,x(g),W(1)),I()});window.addEventListener("sideClick",()=>{if(Y){const t=M[g];if(t.name==="llm"){ee(),X();return}else if(t.name==="canvascolor"){te(),X();return}X()}else I()});function ie(){K(),l.addEventListener("mousedown",ne),l.addEventListener("mousemove",oe),l.addEventListener("mouseup",H),l.addEventListener("mouseleave",H),l.addEventListener("touchstart",e=>{e.preventDefault();const o=e.touches[0],i=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(i)}),l.addEventListener("touchmove",e=>{e.preventDefault();const o=e.touches[0],i=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(i)}),l.addEventListener("touchend",e=>{e.preventDefault();const o=new MouseEvent("mouseup",{});l.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",J),document.getElementById("resetBtn").addEventListener("click",j),document.querySelectorAll(".tool-item").forEach((e,o)=>{e.addEventListener("click",()=>{x(o),X()})}),document.querySelectorAll(".color-swatch").forEach(e=>{e.addEventListener("click",()=>{u=e.dataset.color,q()})}),q();function t(){Math.random()<.3&&(Z(),_()),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",ie);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");e&&o&&(e.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});
