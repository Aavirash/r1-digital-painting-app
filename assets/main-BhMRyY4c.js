(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let r,n,x=!1,X="brush",v="#FE5F00",A="#000000",u=5,k=!1,E=0,T=[],I={x:0,y:0,z:0},f=1,M=[],D=4,F=0,C=!1,P=null;const L=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"drip",icon:'<i class="fas fa-fill-drip"></i>',label:"Drip Paint"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"particles",icon:'<i class="fas fa-sparkles"></i>',label:"Meditation"}];function j(){r=document.getElementById("paintCanvas"),n=r.getContext("2d"),r.width=window.innerWidth,r.height=window.innerHeight,n.lineCap="round",n.lineJoin="round",n.fillStyle=A,n.fillRect(0,0,r.width,r.height),z()}function z(){M.push(n.getImageData(0,0,r.width,r.height)),M.length>20&&M.shift()}function Q(){if(M.length>1){M.pop();const e=M[M.length-1];n.putImageData(e,0,0),_()}}function _(){const e=document.createElement("div");e.textContent="Undo",e.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 10px 20px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(e),setTimeout(()=>{e.remove()},1e3)}function ee(){n.fillStyle=A,n.fillRect(0,0,r.width,r.height),z(),y.prevPositions&&(y.prevPositions=[]),T.length=0}function p(e,t){n.fillStyle=v,n.strokeStyle=v,n.lineWidth=u*f,p.prevX!==null&&p.prevY!==null&&(n.beginPath(),n.moveTo(p.prevX,p.prevY),n.lineTo(e,t),n.stroke()),n.beginPath(),n.arc(e,t,u*f*.5,0,Math.PI*2),n.fill(),p.prevX=e,p.prevY=t}function d(e,t){const o=r.width/2,l=r.height/2,i=12;n.fillStyle=v,n.strokeStyle=v,n.lineWidth=u*f*.5;for(let a=0;a<i;a++){const s=a*Math.PI*2/i,c=Math.cos(s),g=Math.sin(s),w=o+(e-o)*c-(t-l)*g,b=l+(e-o)*g+(t-l)*c,Y=o+(o-w),O=l+(l-b);if(d.prevX!==null&&d.prevY!==null){const q=o+(d.prevX-o)*c-(d.prevY-l)*g,G=l+(d.prevX-o)*g+(d.prevY-l)*c,Z=o+(o-q),$=l+(l-G);n.beginPath(),n.moveTo(q,G),n.lineTo(w,b),n.stroke(),n.beginPath(),n.moveTo(Z,$),n.lineTo(Y,O),n.stroke()}n.beginPath(),n.arc(w,b,u*f*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(Y,O,u*f*.3,0,Math.PI*2),n.fill()}d.prevX=e,d.prevY=t}function y(e,t){n.fillStyle=v,n.strokeStyle=v,n.lineWidth=u*f*.8;const o=r.width/2,l=r.height/2;y.prevPositions||(y.prevPositions=[]);const i=[];for(let a=0;a<D;a++){const s=a*Math.PI*2/D,c=Math.cos(s),g=Math.sin(s),w=o+(e-o)*c-(t-l)*g,b=l+(e-o)*g+(t-l)*c;i.push({x:w,y:b})}y.prevPositions.length===i.length&&x&&i.forEach((a,s)=>{const c=y.prevPositions[s];n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(a.x,a.y),n.stroke(),n.beginPath(),n.arc(a.x,a.y,u*f*.3,0,Math.PI*2),n.fill()}),y.prevPositions=i}function m(e,t){n.fillStyle=v,n.strokeStyle=v,n.lineWidth=u*f,m.prevX!==null&&m.prevY!==null&&(n.beginPath(),n.moveTo(m.prevX,m.prevY),n.lineTo(e,t),n.stroke()),m.prevX=e,m.prevY=t}function h(e,t){if(n.fillStyle=v,n.strokeStyle=v,n.lineWidth=u*f,h.prevX!==null&&h.prevY!==null&&(n.beginPath(),n.moveTo(h.prevX,h.prevY),n.lineTo(e,t),n.stroke()),n.beginPath(),n.arc(e,t,u*f*.5,0,Math.PI*2),n.fill(),Math.random()<.1*f){const o=Math.floor(Math.random()*3)+1;for(let l=0;l<o;l++){const i=e+(Math.random()-.5)*u,a=u*(Math.random()*2+1)*f;n.beginPath(),n.moveTo(i,t),n.lineTo(i,t+a),n.stroke()}}h.prevX=e,h.prevY=t}p.prevX=null;p.prevY=null;d.prevX=null;d.prevY=null;y.prevPositions=[];m.prevX=null;m.prevY=null;h.prevX=null;h.prevY=null;function te(){P||(P=new(window.AudioContext||window.webkitAudioContext))}function ne(e,t=2){if(!P)return;const o=P.currentTime,l=P.createOscillator(),i=P.createGain();l.connect(i),i.connect(P.destination),l.type="sine",l.frequency.value=e,i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.2,o+.1),i.gain.exponentialRampToValueAtTime(.01,o+t),l.start(o),l.stop(o+t)}function oe(e,t){return{x:e,y:t,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:2+Math.random()*4,color:"rgba(255, 255, 255, 0.8)",life:1,decay:.015+Math.random()*.01,shine:Math.random()*.3+.7}}function U(e,t,o=8){for(let a=0;a<o;a++)T.push(oe(e+(Math.random()-.5)*20,t+(Math.random()-.5)*20));const l=[130.81,164.81,196,261.63,329.63,392,523.25],i=l[Math.floor(Math.random()*l.length)];ne(i,2)}function ie(){for(let t=T.length-1;t>=0;t--){const o=T[t];o.x+=o.vx+I.x*.1,o.y+=o.vy+I.y*.1,o.x<-o.size&&(o.x=r.width+o.size),o.x>r.width+o.size&&(o.x=-o.size),o.y<-o.size&&(o.y=r.height+o.size),o.y>r.height+o.size&&(o.y=-o.size),o.vx*=.98,o.vy*=.98,o.life-=o.decay,o.life<=0&&T.splice(t,1)}}function le(){T.forEach(e=>{n.save(),n.globalAlpha=e.life;const t=n.createRadialGradient(e.x-e.size*.3,e.y-e.size*.3,0,e.x,e.y,e.size);t.addColorStop(0,`rgba(255, 255, 255, ${e.shine})`),t.addColorStop(.5,e.color),t.addColorStop(1,"transparent"),n.fillStyle=t,n.beginPath(),n.arc(e.x,e.y,e.size,0,Math.PI*2),n.fill(),n.restore()}),n.globalAlpha=1}function S(){k=!0;const e=document.getElementById("toolSelector");e.classList.remove("hidden"),e.classList.add("visible"),V()}function B(){k=!1;const e=document.getElementById("toolSelector");e.classList.remove("visible"),e.classList.add("hidden")}function V(){const e=document.getElementById("selectedTool");e&&(e.innerHTML=L[E].icon)}function R(){switch(E=(E+1)%L.length,X=L[E].name,V(),X){case"symmetry":D=4;break;case"kaleidoscope":break;case"brush":break;case"lines":break;case"drip":break;case"particles":te();break}console.log(`Selected tool: ${L[E].label}`)}function K(){if(typeof PluginMessageHandler<"u"){const e={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(e))}}function W(){document.querySelectorAll(".color-swatch").forEach(t=>{t.classList.remove("active"),t.dataset.color===v&&t.classList.add("active")})}function ae(){C=!C;const e=document.getElementById("colorPicker"),t=document.querySelector(".color-palette");C?(e.style.display="flex",t.style.display="none"):(e.style.display="none",t.style.display="flex")}function re(e){A=e,n.fillStyle=A,n.fillRect(0,0,r.width,r.height),z(),C=!1;const t=document.getElementById("colorPicker"),o=document.querySelector(".color-palette");t.style.display="none",o.style.display="flex"}function se(e){x=!0;const t=r.getBoundingClientRect(),o=e.clientX-t.left,l=e.clientY-t.top;if(X==="particles"){U(o,l,10);return}J(o,l)}function ce(e){if(!x)return;const t=r.getBoundingClientRect(),o=e.clientX-t.left,l=e.clientY-t.top;if(X==="particles"){Math.random()<.3&&U(o,l,3);return}J(o,l)}function H(){x&&(x=!1,z(),p.prevX=null,p.prevY=null,d.prevX=null,d.prevY=null,m.prevX=null,m.prevY=null,h.prevX=null,h.prevY=null)}function J(e,t){switch(X){case"brush":p(e,t);break;case"kaleidoscope":d(e,t);break;case"symmetry":y(e,t);break;case"lines":m(e,t);break;case"drip":h(e,t);break}}function de(){window.DeviceMotionEvent&&window.addEventListener("devicemotion",i=>{i.accelerationIncludingGravity&&(I.x=i.accelerationIncludingGravity.x||0,I.y=i.accelerationIncludingGravity.y||0,I.z=i.accelerationIncludingGravity.z||0)});let e=0,t=0,o=0,l=15;window.addEventListener("devicemotion",i=>{if(i.accelerationIncludingGravity){const a=i.accelerationIncludingGravity.x||0,s=i.accelerationIncludingGravity.y||0,c=i.accelerationIncludingGravity.z||0,g=Math.abs(a-e),w=Math.abs(s-t),b=Math.abs(c-o);if(e=a,t=s,o=c,X!=="particles"&&(g>l||w>l||b>l)){const Y=Date.now();Y-F>1e3&&(F=Y,ee())}}})}window.addEventListener("scrollUp",()=>{S()});window.addEventListener("scrollDown",()=>{R(),k||S()});window.addEventListener("sideClick",()=>{if(L[E].name==="llm"){K();return}k?B():S()});document.addEventListener("keydown",e=>{if(e.key==="ArrowUp"&&(S(),e.preventDefault()),e.key==="ArrowDown"&&(R(),k||S(),e.preventDefault()),e.key==="Enter"){if(L[E].name==="llm"){K();return}k?B():S(),e.preventDefault()}});function ue(){j(),de(),r.addEventListener("mousedown",se),r.addEventListener("mousemove",ce),r.addEventListener("mouseup",H),r.addEventListener("mouseleave",H),r.addEventListener("touchstart",t=>{t.preventDefault();const o=t.touches[0],l=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});r.dispatchEvent(l)}),r.addEventListener("touchmove",t=>{t.preventDefault();const o=t.touches[0],l=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});r.dispatchEvent(l)}),r.addEventListener("touchend",t=>{t.preventDefault();const o=new MouseEvent("mouseup",{});r.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",Q),document.getElementById("canvasColorBtn").addEventListener("click",ae),document.getElementById("closeSelector").addEventListener("click",B),document.getElementById("selectedTool").addEventListener("click",()=>{R()}),document.querySelectorAll(".color-palette .color-swatch").forEach(t=>{t.addEventListener("click",()=>{v=t.dataset.color,W()})}),document.querySelectorAll("#colorPicker .color-swatch").forEach(t=>{t.addEventListener("click",()=>{re(t.dataset.color)})}),W();function e(){ie(),le(),requestAnimationFrame(e)}e(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",ue);window.handleLLMResponse=function(e){const t=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");t&&o&&(t.textContent=e,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",e=>{const t=document.getElementById("adviceOverlay");t&&e.target===t&&(t.style.display="none")});let N;document.addEventListener("mousemove",()=>{clearTimeout(N),k&&(N=setTimeout(()=>{B()},3e3))});
