(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(l){if(l.ep)return;l.ep=!0;const s=n(l);fetch(l.href,s)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let a,t,I=!1,M="kaleidoscope",u="#FE5F00",b=5,x=!1,E=0,h=0,k=[],v=1,w=[],B=4;const y=[{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"watercolor",icon:'<i class="fas fa-paint-brush"></i>',label:"Watercolor"},{name:"eraser",icon:'<i class="fas fa-eraser"></i>',label:"Eraser"},{name:"text",icon:'<i class="fas fa-font"></i>',label:"Text"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"palette",icon:'<i class="fas fa-palette"></i>',label:"Palette"}];function V(){a=document.getElementById("paintCanvas"),t=a.getContext("2d"),a.width=240,a.height=230,t.lineCap="round",t.lineJoin="round",t.fillStyle="#000",t.fillRect(0,0,a.width,a.height),z()}function z(){w.push(t.getImageData(0,0,a.width,a.height)),w.length>20&&w.shift()}function j(){if(w.length>1){w.pop();const o=w[w.length-1];t.putImageData(o,0,0),Q()}}function Q(){const o=document.createElement("div");o.textContent="Undo",o.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 2vw 4vw;
    border-radius: 2vw;
    font-size: 4vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(o),setTimeout(()=>{o.remove()},1e3)}function Z(){t.fillStyle="#000",t.fillRect(0,0,a.width,a.height),z(),p.prevPositions&&(p.prevPositions=[]),f.prevX=null,f.prevY=null,k.length=0;const o=document.createElement("div");o.textContent="Reset",o.style.cssText=`
    position: fixed;
    top: 20%;
    right: 4vw;
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 2vw 3vw;
    border-radius: 2vw;
    font-size: 3vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(o),setTimeout(()=>{o.remove()},1500)}function _(o,e){const n=a.width/2,i=a.height/2,l=12,s=Math.sqrt((o-n)**2+(e-i)**2),c=Math.sqrt(n**2+i**2),d=s/c;t.fillStyle=u,t.strokeStyle=u,t.lineWidth=b*v*.5;for(let r=0;r<3;r++){const g=(.8-r*.2)*(1-d*.3);t.globalAlpha=g;const m=r*2,P=b*v*(1+r*.3);for(let F=0;F<l;F++){const q=F*Math.PI*2/l,D=Math.cos(q),Y=Math.sin(q),A=n+(o-n)*D-(e-i)*Y,S=i+(o-n)*Y+(e-i)*D,H=n+(n-A),W=i+(i-S);if(t.beginPath(),t.arc(A+m,S+m,P,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(H-m,W-m,P*.8,0,Math.PI*2),t.fill(),r===0&&F%2===0&&(t.beginPath(),t.moveTo(A,S),t.lineTo(H,W),t.stroke()),d>.3){const $=10*v,J=A+D*$,G=S+Y*$;t.beginPath(),t.moveTo(A,S),t.lineTo(J,G),t.stroke()}}}if(s<20){t.globalAlpha=.9,t.fillStyle="#FFFFFF";for(let r=0;r<4;r++){const g=r*Math.PI/2+Date.now()*.01,m=n+Math.cos(g)*5,P=i+Math.sin(g)*5;t.beginPath(),t.arc(m,P,1,0,Math.PI*2),t.fill()}}t.globalAlpha=1}function p(o,e){t.fillStyle=u,t.strokeStyle=u,t.lineWidth=b*v*.8;const n=a.width/2,i=a.height/2;p.prevPositions||(p.prevPositions=[]);const l=[];for(let s=0;s<B;s++){const c=s*Math.PI*2/B,d=Math.cos(c),r=Math.sin(c),g=n+(o-n)*d-(e-i)*r,m=i+(o-n)*r+(e-i)*d;l.push({x:g,y:m})}p.prevPositions.length===l.length&&I&&l.forEach((s,c)=>{const d=p.prevPositions[c];t.beginPath(),t.moveTo(d.x,d.y),t.lineTo(s.x,s.y),t.stroke(),t.beginPath(),t.arc(s.x,s.y,b*v*.5,0,Math.PI*2),t.fill()}),p.prevPositions=l,Math.random()<.3&&C(o,e,2)}function ee(o,e){t.fillStyle=u,t.strokeStyle=u;const n=b*v*2,i=.1+Math.random()*.2;t.globalAlpha=i,t.beginPath();for(let l=0;l<8;l++){const s=l*Math.PI*2/8,c=n*(.7+Math.random()*.6),d=o+Math.cos(s)*c,r=e+Math.sin(s)*c;l===0?t.moveTo(d,r):t.lineTo(d,r)}t.closePath(),t.fill(),Math.random()<.4&&(t.globalAlpha=i*.5,t.beginPath(),t.arc(o+(Math.random()-.5)*n,e+(Math.random()-.5)*n,n*.8,0,Math.PI*2),t.fill()),t.globalAlpha=1,Math.random()<.5&&C(o,e,1)}function f(o,e){t.globalCompositeOperation="destination-out",t.strokeStyle="rgba(0,0,0,1)",t.lineWidth=b*v*1.5,f.prevX!==null&&f.prevY!==null&&(t.beginPath(),t.moveTo(f.prevX,f.prevY),t.lineTo(o,e),t.stroke()),t.beginPath(),t.arc(o,e,b*v*.75,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over",f.prevX=o,f.prevY=e}p.prevPositions=[];f.prevX=null;f.prevY=null;function te(o,e,n="paint"){return{x:o,y:e,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,size:Math.random()*3+1,color:u,life:1,decay:Math.random()*.02+.01,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.1,bounce:.8,type:n,trail:[{x:o,y:e}]}}function oe(){for(let o=k.length-1;o>=0;o--){const e=k[o];e.x+=e.vx,e.y+=e.vy,e.vy+=.1,e.trail.push({x:e.x,y:e.y}),e.trail.length>5&&e.trail.shift(),e.rotation+=e.rotationSpeed,(e.x<=e.size||e.x>=a.width-e.size)&&(e.vx*=-e.bounce,e.x=Math.max(e.size,Math.min(a.width-e.size,e.x))),(e.y<=e.size||e.y>=a.height-e.size)&&(e.vy*=-e.bounce,e.y=Math.max(e.size,Math.min(a.height-e.size,e.y))),e.vx*=.995,e.vy*=.995,e.life-=e.decay,(e.life<=0||e.size<=.1)&&k.splice(o,1)}}function ne(){k.forEach(o=>{if(o.trail.length>1){t.globalAlpha=o.life*.3,t.strokeStyle=o.color,t.lineWidth=o.size*.5,t.beginPath(),t.moveTo(o.trail[0].x,o.trail[0].y);for(let e=1;e<o.trail.length;e++)t.lineTo(o.trail[e].x,o.trail[e].y);t.stroke()}switch(t.save(),t.translate(o.x,o.y),t.rotate(o.rotation),t.globalAlpha=o.life,o.type){case"sparkle":t.fillStyle=o.color,t.beginPath();for(let n=0;n<5;n++){const i=n*Math.PI*2/5,l=Math.cos(i)*o.size,s=Math.sin(i)*o.size;n===0?t.moveTo(l,s):t.lineTo(l,s)}t.closePath(),t.fill();break;case"kaleidoscope":const e=6;for(let n=0;n<e;n++){const i=n*Math.PI*2/e;t.fillStyle=`hsl(${(Date.now()*.1+n*60)%360}, 70%, 60%)`,t.beginPath(),t.moveTo(0,0),t.arc(0,0,o.size,i,i+Math.PI*2/e),t.fill()}break;default:t.fillStyle=o.color,t.beginPath(),t.arc(0,0,o.size,0,Math.PI*2),t.fill(),o.life>.5&&(t.globalAlpha=(o.life-.5)*.5,t.fillStyle="#FFFFFF",t.beginPath(),t.arc(0,0,o.size*.5,0,Math.PI*2),t.fill());break}t.restore()}),t.globalAlpha=1}function C(o,e,n=5){const i=M==="kaleidoscope"?"kaleidoscope":M==="watercolor"?"watercolor":"paint";for(let l=0;l<n*v;l++)k.push(te(o+(Math.random()-.5)*10,e+(Math.random()-.5)*10,i))}function L(){x=!0;const o=document.getElementById("toolbar");o.style.transform="translateY(0)",O(),clearTimeout(window.toolbarHideTimeout),window.toolbarHideTimeout=setTimeout(()=>{x&&T()},3e3)}function T(){x=!1;const o=document.getElementById("toolbar");o.style.transform="translateY(100%)",clearTimeout(window.toolbarHideTimeout)}function O(){const o=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(o.forEach((n,i)=>{const c=180/(y.length-1),r=(-90+i*c+E)*Math.PI/180,g=18,m=Math.cos(r)*g,P=Math.sin(r)*g;n.style.transform=`translate(${m}vw, ${P}vw) scale(${i===h?1.1:1})`,n.classList.toggle("selected",i===h),n.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)"}),e){const n=y[h];e.innerHTML=n.icon,e.title=n.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.2s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},200)}}function U(o){E+=o*15,E>360&&(E-=360),E<-360&&(E+=360),O()}function R(o){if(o<0||o>=y.length)return;switch(h=o,M=y[o].name,O(),M){case"symmetry":B=4;break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},150)),console.log(`Selected tool: ${y[o].label}`)}function ie(){if(typeof PluginMessageHandler<"u"){const o={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(o))}}function X(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===u&&e.classList.add("active")})}function ae(){const o=prompt("Enter text to add:")||"Hello R1!";t.font=`${b*4}px Arial`,t.fillStyle=u,t.textAlign="center",t.fillText(o,a.width/2,a.height/2),z()}function le(o){I=!0;const e=a.getBoundingClientRect(),n=(o.clientX-e.left)*(a.width/e.width),i=(o.clientY-e.top)*(a.height/e.height);M!=="eraser"&&C(n,i,3),K(n,i)}function se(o){if(!I)return;const e=a.getBoundingClientRect(),n=(o.clientX-e.left)*(a.width/e.width),i=(o.clientY-e.top)*(a.height/e.height);M!=="eraser"&&Math.random()<.7&&C(n,i,1),K(n,i)}function N(){I&&(I=!1,z())}function K(o,e){switch(M){case"kaleidoscope":_(o,e);break;case"symmetry":p(o,e);break;case"watercolor":ee(o,e);break;case"eraser":f(o,e);break}}window.addEventListener("scrollUp",()=>{x&&(h=(h-1+y.length)%y.length,R(h),U(-1)),L()});window.addEventListener("scrollDown",()=>{x&&(h=(h+1)%y.length,R(h),U(1)),L()});window.addEventListener("sideClick",()=>{if(x){const o=y[h];if(o.name==="llm"){ie(),T();return}else if(o.name==="palette"){const e=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FE5F00","#FFFFFF"];u=e[Math.floor(Math.random()*e.length)],X(),T();return}else if(o.name==="text"){ae(),T();return}T()}else L()});function re(){V(),a.addEventListener("mousedown",le),a.addEventListener("mousemove",se),a.addEventListener("mouseup",N),a.addEventListener("mouseleave",N),a.addEventListener("touchstart",e=>{e.preventDefault();const n=e.touches[0],i=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});a.dispatchEvent(i)}),a.addEventListener("touchmove",e=>{e.preventDefault();const n=e.touches[0],i=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});a.dispatchEvent(i)}),a.addEventListener("touchend",e=>{e.preventDefault();const n=new MouseEvent("mouseup",{});a.dispatchEvent(n)}),document.getElementById("undoBtn").addEventListener("click",j),document.getElementById("resetBtn").addEventListener("click",Z),document.querySelectorAll(".tool-item").forEach((e,n)=>{e.addEventListener("click",()=>{R(n),T()})}),document.querySelectorAll(".color-swatch").forEach(e=>{e.addEventListener("click",()=>{u=e.dataset.color,X()})}),X();function o(){oe(),ne(),requestAnimationFrame(o)}o(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",re);window.handleLLMResponse=function(o){const e=document.getElementById("adviceText"),n=document.getElementById("adviceOverlay");e&&n&&(e.textContent=o,n.style.display="flex",setTimeout(()=>{n.style.display="none"},5e3))};document.addEventListener("click",o=>{const e=document.getElementById("adviceOverlay");e&&o.target===e&&(e.style.display="none")});
