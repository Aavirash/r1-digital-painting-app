(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let l,n,k=!1,S="brush",u="#FE5F00",y=5,X=!1,T=0,m=0,Y=[],p=1,M=[],A=4;const w=[{name:"brush",icon:'<i class="fas fa-paint-brush"></i>',label:"Brush"},{name:"kaleidoscope",icon:'<i class="fas fa-magic"></i>',label:"Kaleidoscope"},{name:"symmetry",icon:'<i class="fas fa-sync-alt"></i>',label:"Symmetry"},{name:"eraser",icon:'<i class="fas fa-eraser"></i>',label:"Eraser"},{name:"lines",icon:'<i class="fas fa-slash"></i>',label:"Lines"},{name:"llm",icon:'<i class="fas fa-microphone"></i>',label:"AI Advice"},{name:"palette",icon:'<i class="fas fa-palette"></i>',label:"Palette"}];function K(){l=document.getElementById("paintCanvas"),n=l.getContext("2d"),l.width=240,l.height=230,n.lineCap="round",n.lineJoin="round",n.fillStyle="#000",n.fillRect(0,0,l.width,l.height),D()}function D(){M.push(n.getImageData(0,0,l.width,l.height)),M.length>20&&M.shift()}function J(){if(M.length>1){M.pop();const t=M[M.length-1];n.putImageData(t,0,0),G()}}function G(){const t=document.createElement("div");t.textContent="Undo",t.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 2vw 4vw;
    border-radius: 2vw;
    font-size: 4vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)}function V(){n.fillStyle="#000",n.fillRect(0,0,l.width,l.height),D(),b.prevPositions&&(b.prevPositions=[]),d.prevX=null,d.prevY=null,Y.length=0;const t=document.createElement("div");t.textContent="Reset",t.style.cssText=`
    position: fixed;
    top: 20%;
    right: 4vw;
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 2vw 3vw;
    border-radius: 2vw;
    font-size: 3vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(t),setTimeout(()=>{t.remove()},1500)}function v(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=y*p,v.prevX!==null&&v.prevY!==null&&(n.beginPath(),n.moveTo(v.prevX,v.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,y*p*.5,0,Math.PI*2),n.fill(),v.prevX=t,v.prevY=e}function c(t,e){const o=l.width/2,i=l.height/2,r=12;n.fillStyle=u,n.strokeStyle=u,n.lineWidth=y*p*.5;for(let s=0;s<r;s++){const a=s*Math.PI*2/r,f=Math.cos(a),g=Math.sin(a),E=o+(t-o)*f-(e-i)*g,P=i+(t-o)*g+(e-i)*f,C=o+(o-E),F=i+(i-P);if(c.prevX!==null&&c.prevY!==null){const R=o+(c.prevX-o)*f-(c.prevY-i)*g,O=i+(c.prevX-o)*g+(c.prevY-i)*f,U=o+(o-R),$=i+(i-O);n.beginPath(),n.moveTo(R,O),n.lineTo(E,P),n.stroke(),n.beginPath(),n.moveTo(U,$),n.lineTo(C,F),n.stroke()}n.beginPath(),n.arc(E,P,y*p*.3,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(C,F,y*p*.3,0,Math.PI*2),n.fill()}c.prevX=t,c.prevY=e}function b(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=y*p*.8;const o=l.width/2,i=l.height/2;b.prevPositions||(b.prevPositions=[]);const r=[];for(let s=0;s<A;s++){const a=s*Math.PI*2/A,f=Math.cos(a),g=Math.sin(a),E=o+(t-o)*f-(e-i)*g,P=i+(t-o)*g+(e-i)*f;r.push({x:E,y:P})}b.prevPositions.length===r.length&&k&&r.forEach((s,a)=>{const f=b.prevPositions[a];n.beginPath(),n.moveTo(f.x,f.y),n.lineTo(s.x,s.y),n.stroke(),n.beginPath(),n.arc(s.x,s.y,y*p*.3,0,Math.PI*2),n.fill()}),b.prevPositions=r}function h(t,e){n.fillStyle=u,n.strokeStyle=u,n.lineWidth=y*p,h.prevX!==null&&h.prevY!==null&&(n.beginPath(),n.moveTo(h.prevX,h.prevY),n.lineTo(t,e),n.stroke()),h.prevX=t,h.prevY=e}function d(t,e){n.globalCompositeOperation="destination-out",n.strokeStyle="rgba(0,0,0,1)",n.lineWidth=y*p*1.5,d.prevX!==null&&d.prevY!==null&&(n.beginPath(),n.moveTo(d.prevX,d.prevY),n.lineTo(t,e),n.stroke()),n.beginPath(),n.arc(t,e,y*p*.75,0,Math.PI*2),n.fill(),n.globalCompositeOperation="source-over",d.prevX=t,d.prevY=e}v.prevX=null;v.prevY=null;c.prevX=null;c.prevY=null;b.prevPositions=[];h.prevX=null;h.prevY=null;d.prevX=null;d.prevY=null;function j(t,e,o="simple"){return{x:t,y:e,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:Math.random()*2+1,color:u,life:1,decay:Math.random()*.05+.02,type:o}}function Q(){for(let t=Y.length-1;t>=0;t--){const e=Y[t];e.x+=e.vx,e.y+=e.vy,e.vy+=.05,(e.x<=e.size||e.x>=l.width-e.size)&&(e.vx*=-.8,e.x=Math.max(e.size,Math.min(l.width-e.size,e.x))),(e.y<=e.size||e.y>=l.height-e.size)&&(e.vy*=-.8,e.y=Math.max(e.size,Math.min(l.height-e.size,e.y))),e.vx*=.98,e.vy*=.98,e.life-=e.decay,(e.life<=0||e.size<=.1)&&Y.splice(t,1)}}function Z(){Y.forEach(t=>{n.globalAlpha=t.life,n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,t.size,0,Math.PI*2),n.fill()}),n.globalAlpha=1}function H(t,e,o=3){for(let i=0;i<o*p;i++)Y.push(j(t+(Math.random()-.5)*5,e+(Math.random()-.5)*5,"simple"))}function I(){X=!0;const t=document.getElementById("toolbar");t.style.transform="translateY(0)",x(),clearTimeout(window.toolbarHideTimeout),window.toolbarHideTimeout=setTimeout(()=>{X&&L()},3e3)}function L(){X=!1;const t=document.getElementById("toolbar");t.style.transform="translateY(100%)",clearTimeout(window.toolbarHideTimeout)}function x(){const t=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(t.forEach((o,i)=>{const a=180/(w.length-1),g=(-90+i*a+T)*Math.PI/180,E=20,P=Math.cos(g)*E,C=Math.sin(g)*E;o.style.transform=`translate(${P}vw, ${C}vw) scale(${i===m?1.1:1})`,o.classList.toggle("selected",i===m),o.style.transition="all 0.2s ease"}),e){const o=w[m];e.innerHTML=o.icon,e.title=o.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.1s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)}}function W(t){T+=t*15,T>360&&(T-=360),T<-360&&(T+=360),x()}function z(t){if(t<0||t>=w.length)return;switch(m=t,S=w[t].name,x(),S){case"symmetry":A=4;break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},100)),console.log(`Selected tool: ${w[t].label}`)}function _(){if(typeof PluginMessageHandler<"u"){const t={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(t))}}function B(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===u&&e.classList.add("active")})}function ee(t){k=!0;const e=l.getBoundingClientRect(),o=(t.clientX-e.left)*(l.width/e.width),i=(t.clientY-e.top)*(l.height/e.height);S!=="eraser"&&H(o,i,1),N(o,i)}function te(t){if(!k)return;const e=l.getBoundingClientRect(),o=(t.clientX-e.left)*(l.width/e.width),i=(t.clientY-e.top)*(l.height/e.height);S!=="eraser"&&Math.random()<.3&&H(o,i,1),N(o,i)}function q(){k&&(k=!1,D(),v.prevX=null,v.prevY=null,c.prevX=null,c.prevY=null,h.prevX=null,h.prevY=null,d.prevX=null,d.prevY=null)}function N(t,e){switch(S){case"brush":v(t,e);break;case"kaleidoscope":c(t,e);break;case"symmetry":b(t,e);break;case"lines":h(t,e);break;case"eraser":d(t,e);break}}window.addEventListener("scrollUp",()=>{X&&(m=(m-1+w.length)%w.length,z(m),W(-1)),I()});window.addEventListener("scrollDown",()=>{X&&(m=(m+1)%w.length,z(m),W(1)),I()});window.addEventListener("sideClick",()=>{if(X){const t=w[m];if(t.name==="llm"){_(),L();return}else if(t.name==="palette"){const e=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FE5F00","#FFFFFF"];u=e[Math.floor(Math.random()*e.length)],B(),L();return}L()}else I()});function ne(){K(),l.addEventListener("mousedown",ee),l.addEventListener("mousemove",te),l.addEventListener("mouseup",q),l.addEventListener("mouseleave",q),l.addEventListener("touchstart",e=>{e.preventDefault();const o=e.touches[0],i=new MouseEvent("mousedown",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(i)}),l.addEventListener("touchmove",e=>{e.preventDefault();const o=e.touches[0],i=new MouseEvent("mousemove",{clientX:o.clientX,clientY:o.clientY});l.dispatchEvent(i)}),l.addEventListener("touchend",e=>{e.preventDefault();const o=new MouseEvent("mouseup",{});l.dispatchEvent(o)}),document.getElementById("undoBtn").addEventListener("click",J),document.getElementById("resetBtn").addEventListener("click",V),document.querySelectorAll(".tool-item").forEach((e,o)=>{e.addEventListener("click",()=>{z(o),L()})}),document.querySelectorAll(".color-swatch").forEach(e=>{e.addEventListener("click",()=>{u=e.dataset.color,B()})}),B();function t(){Math.random()<.3&&(Q(),Z()),requestAnimationFrame(t)}t(),console.log("R1 Digital Painting App initialized")}document.addEventListener("DOMContentLoaded",ne);window.handleLLMResponse=function(t){const e=document.getElementById("adviceText"),o=document.getElementById("adviceOverlay");e&&o&&(e.textContent=t,o.style.display="flex",setTimeout(()=>{o.style.display="none"},5e3))};document.addEventListener("click",t=>{const e=document.getElementById("adviceOverlay");e&&t.target===e&&(e.style.display="none")});
