(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Digital Painting App":"Running in browser mode - Digital Painting App");let s,t,F=!1,A="kaleidoscope",v="#FE5F00",u=5,D=!1,I=0,p=0,x=[],Y={x:0,y:0,z:0},f=1,T=[],S=4;const b=[{name:"kaleidoscope",icon:"âœ¨",label:"Kaleidoscope"},{name:"symmetry",icon:"ðŸ”„",label:"Symmetry"},{name:"watercolor",icon:"ðŸŽ¨",label:"Watercolor"},{name:"eraser",icon:"ðŸ§½",label:"Eraser"},{name:"text",icon:"ðŸ“",label:"Text"},{name:"llm",icon:"ðŸŽ¤",label:"AI Advice"},{name:"palette",icon:"ðŸŽ­",label:"Palette"}];function Q(){s=document.getElementById("paintCanvas"),t=s.getContext("2d"),s.width=240,s.height=230,t.lineCap="round",t.lineJoin="round",t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),B()}function B(){T.push(t.getImageData(0,0,s.width,s.height)),T.length>20&&T.shift()}function Z(){if(T.length>1){T.pop();const o=T[T.length-1];t.putImageData(o,0,0),_()}}function _(){const o=document.createElement("div");o.textContent="Undo",o.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(254, 95, 0, 0.9);
    color: #000;
    padding: 2vw 4vw;
    border-radius: 2vw;
    font-size: 4vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(o),setTimeout(()=>{o.remove()},1e3)}function ee(){t.fillStyle="#000",t.fillRect(0,0,s.width,s.height),B(),w.prevPositions&&(w.prevPositions=[]),h.prevX=null,h.prevY=null,x.length=0;const o=document.createElement("div");o.textContent="Reset",o.style.cssText=`
    position: fixed;
    top: 20%;
    right: 4vw;
    background: rgba(255, 255, 255, 0.9);
    color: #000;
    padding: 2vw 3vw;
    border-radius: 2vw;
    font-size: 3vw;
    font-weight: bold;
    z-index: 100;
    pointer-events: none;
  `,document.body.appendChild(o),setTimeout(()=>{o.remove()},1500)}function te(o,e){const n=s.width/2,a=s.height/2,l=12,i=Math.sqrt((o-n)**2+(e-a)**2),r=Math.sqrt(n**2+a**2),c=i/r;t.fillStyle=v,t.strokeStyle=v,t.lineWidth=u*f*.5;for(let d=0;d<3;d++){const m=(.8-d*.2)*(1-c*.3);t.globalAlpha=m;const g=d*2,y=u*f*(1+d*.3);for(let M=0;M<l;M++){const L=M*Math.PI*2/l,k=Math.cos(L),z=Math.sin(L),P=n+(o-n)*k-(e-a)*z,E=a+(o-n)*z+(e-a)*k,H=n+(n-P),U=a+(a-E);if(t.beginPath(),t.arc(P+g,E+g,y,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(H-g,U-g,y*.8,0,Math.PI*2),t.fill(),d===0&&M%2===0&&(t.beginPath(),t.moveTo(P,E),t.lineTo(H,U),t.stroke()),c>.3){const W=10*f,j=P+k*W,G=E+z*W;t.beginPath(),t.moveTo(P,E),t.lineTo(j,G),t.stroke()}}}if(i<20){t.globalAlpha=.9,t.fillStyle="#FFFFFF";for(let d=0;d<4;d++){const m=d*Math.PI/2+Date.now()*.01,g=n+Math.cos(m)*5,y=a+Math.sin(m)*5;t.beginPath(),t.arc(g,y,1,0,Math.PI*2),t.fill()}}t.globalAlpha=1}function w(o,e){t.fillStyle=v,t.strokeStyle=v,t.lineWidth=u*f*.8;const n=s.width/2,a=s.height/2;w.prevPositions||(w.prevPositions=[]);const l=[];for(let i=0;i<S;i++){const r=i*Math.PI*2/S,c=Math.cos(r),d=Math.sin(r),m=n+(o-n)*c-(e-a)*d,g=a+(o-n)*d+(e-a)*c;l.push({x:m,y:g})}if(w.prevPositions.length===l.length&&F?l.forEach((i,r)=>{const c=w.prevPositions[r];t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(i.x,i.y),t.stroke();const d=Math.sqrt((i.x-c.x)**2+(i.y-c.y)**2),m=Math.max(1,Math.floor(d/2));for(let g=0;g<=m;g++){const y=g/m,M=c.x+(i.x-c.x)*y,L=c.y+(i.y-c.y)*y;t.globalAlpha=.7,t.beginPath(),t.arc(M,L,u*f,0,Math.PI*2),t.fill();for(let k=0;k<3;k++){const z=(Math.random()-.5)*u,P=(Math.random()-.5)*u,E=u*f*(.3+Math.random()*.4);t.globalAlpha=.3,t.beginPath(),t.arc(M+z,L+P,E,0,Math.PI*2),t.fill()}}}):l.forEach(i=>{t.globalAlpha=.8,t.beginPath(),t.arc(i.x,i.y,u*f,0,Math.PI*2),t.fill()}),S>2){t.globalAlpha=.1,t.strokeStyle="#FE5F00",t.lineWidth=1;for(let i=0;i<S;i++){const r=i*Math.PI*2/S,c=n+Math.cos(r)*Math.max(s.width,s.height),d=a+Math.sin(r)*Math.max(s.width,s.height);t.beginPath(),t.moveTo(n,a),t.lineTo(c,d),t.stroke()}}w.prevPositions=[...l],t.globalAlpha=1}function oe(o,e){const n=Math.floor(f*5)+3;for(let a=0;a<n;a++){const l=(Math.random()-.5)*u*2,i=(Math.random()-.5)*u*2,r=Math.random()*.3+.1,c=Math.random()*u+2;t.globalAlpha=r,t.fillStyle=v,t.beginPath(),t.arc(o+l,e+i,c,0,Math.PI*2),t.fill()}t.globalAlpha=1}function h(o,e){if((!h.prevX||!h.prevY)&&(h.prevX=o,h.prevY=e),t.globalCompositeOperation="destination-out",t.lineCap="round",t.lineJoin="round",F){t.lineWidth=u*3*f,t.beginPath(),t.moveTo(h.prevX,h.prevY),t.lineTo(o,e),t.stroke();const n=Math.sqrt((o-h.prevX)**2+(e-h.prevY)**2),a=Math.max(1,Math.floor(n/3));for(let l=0;l<=a;l++){const i=l/a,r=h.prevX+(o-h.prevX)*i,c=h.prevY+(e-h.prevY)*i;t.beginPath(),t.arc(r,c,u*2*f,0,Math.PI*2),t.fill()}}else t.beginPath(),t.arc(o,e,u*2*f,0,Math.PI*2),t.fill();h.prevX=o,h.prevY=e,t.globalCompositeOperation="source-over"}function $(o,e,n="paint"){const i=f*2,r={x:o,y:e,vx:(Math.random()-.5)*3+Y.x*15,vy:(Math.random()-.5)*3+Y.y*15,life:1,decay:.015+Math.random()*.01,size:(Math.random()*2+1)*i,color:v,type:n,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2,gravity:.1,bounce:.7,trail:[]};switch(n){case"sparkle":r.size*=.5,r.decay=.03,r.color="#FFFFFF";break;case"paint":r.size*=f,r.gravity=.05;break;case"watercolor":r.size*=1.5,r.decay=.008,r.gravity=.02;break;case"kaleidoscope":r.size*=.8,r.rotationSpeed*=3,r.decay=.025;break}return r}function ne(){for(let o=x.length-1;o>=0;o--){const e=x[o];e.trail.length>5&&e.trail.shift(),e.trail.push({x:e.x,y:e.y,life:e.life}),e.vx+=Y.x*.5,e.vy+=Y.y*.5,e.vy+=e.gravity,e.x+=e.vx,e.y+=e.vy,e.rotation+=e.rotationSpeed,(e.x<=e.size||e.x>=s.width-e.size)&&(e.vx*=-e.bounce,e.x=Math.max(e.size,Math.min(s.width-e.size,e.x))),(e.y<=e.size||e.y>=s.height-e.size)&&(e.vy*=-e.bounce,e.y=Math.max(e.size,Math.min(s.height-e.size,e.y))),e.vx*=.995,e.vy*=.995,e.life-=e.decay,(e.life<=0||e.size<=.1)&&x.splice(o,1)}}function ae(){x.forEach(o=>{if(o.trail.length>1){t.globalAlpha=o.life*.3,t.strokeStyle=o.color,t.lineWidth=o.size*.5,t.beginPath(),t.moveTo(o.trail[0].x,o.trail[0].y);for(let e=1;e<o.trail.length;e++)t.lineTo(o.trail[e].x,o.trail[e].y);t.stroke()}switch(t.save(),t.translate(o.x,o.y),t.rotate(o.rotation),t.globalAlpha=o.life,o.type){case"sparkle":t.fillStyle=o.color,t.beginPath();for(let n=0;n<5;n++){const a=n*Math.PI*2/5,l=Math.cos(a)*o.size,i=Math.sin(a)*o.size;n===0?t.moveTo(l,i):t.lineTo(l,i)}t.closePath(),t.fill();break;case"kaleidoscope":const e=6;for(let n=0;n<e;n++){const a=n*Math.PI*2/e;t.fillStyle=`hsl(${(Date.now()*.1+n*60)%360}, 70%, 60%)`,t.beginPath(),t.moveTo(0,0),t.arc(0,0,o.size,a,a+Math.PI*2/e),t.fill()}break;default:t.fillStyle=o.color,t.beginPath(),t.arc(0,0,o.size,0,Math.PI*2),t.fill(),o.life>.5&&(t.globalAlpha=(o.life-.5)*.5,t.fillStyle="#FFFFFF",t.beginPath(),t.arc(0,0,o.size*.5,0,Math.PI*2),t.fill());break}t.restore()}),t.globalAlpha=1}function N(o,e,n=5){const a=A==="kaleidoscope"?"kaleidoscope":A==="watercolor"?"watercolor":"paint";for(let l=0;l<n*f;l++)x.push($(o+(Math.random()-.5)*10,e+(Math.random()-.5)*10,a));if(Math.random()<.3&&f>1.5)for(let l=0;l<2;l++)x.push($(o,e,"sparkle"))}function X(){D=!0;const o=document.getElementById("toolbar");o.style.transform="translateY(0)",O(),clearTimeout(window.toolbarHideTimeout),window.toolbarHideTimeout=setTimeout(()=>{D&&C()},3e3)}function C(){D=!1;const o=document.getElementById("toolbar");o.style.transform="translateY(100%)",clearTimeout(window.toolbarHideTimeout)}function O(){const o=document.querySelectorAll(".tool-item"),e=document.getElementById("centerTool");if(o.forEach((n,a)=>{const r=180/(b.length-1),d=(-90+a*r+I)*Math.PI/180,m=18,g=Math.cos(d)*m,y=Math.sin(d)*m;n.style.transform=`translate(${g}vw, ${y}vw) scale(${a===p?1.1:1})`,n.classList.toggle("selected",a===p),n.style.transition="all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1)"}),e){const n=b[p];e.textContent=n.icon,e.title=n.label,e.style.transform="translate(-50%, -50%) scale(1.1)",e.style.transition="transform 0.2s ease",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},200)}}function J(o){I+=o*15,I>360&&(I-=360),I<-360&&(I+=360),O()}function q(o){if(o<0||o>=b.length)return;switch(p=o,A=b[o].name,O(),A){case"symmetry":S=4;break}const e=document.getElementById("centerTool");e&&(e.style.transform="translate(-50%, -50%) scale(1.2)",setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1)"},150)),console.log(`Selected tool: ${b[o].label}`)}function ie(){if(typeof PluginMessageHandler<"u"){const o={message:"Give me creative painting advice or inspiration in 2-3 sentences. Be encouraging and artistic.",useLLM:!0,wantsR1Response:!0};PluginMessageHandler.postMessage(JSON.stringify(o))}}function le(){if(typeof PluginMessageHandler<"u"){const e={message:`Please send this digital artwork to my email: ${s.toDataURL("image/png")}`,useLLM:!0};PluginMessageHandler.postMessage(JSON.stringify(e))}}function R(){document.querySelectorAll(".color-swatch").forEach(e=>{e.classList.remove("active"),e.dataset.color===v&&e.classList.add("active")})}function se(){const o=prompt("Enter text to add:")||"Hello R1!";t.font=`${u*4}px Arial`,t.fillStyle=v,t.textAlign="center",t.fillText(o,s.width/2,s.height/2),B()}function re(o){F=!0;const e=s.getBoundingClientRect(),n=(o.clientX-e.left)*(s.width/e.width),a=(o.clientY-e.top)*(s.height/e.height);A!=="eraser"&&N(n,a,3),V(n,a)}function ce(o){if(!F)return;const e=s.getBoundingClientRect(),n=(o.clientX-e.left)*(s.width/e.width),a=(o.clientY-e.top)*(s.height/e.height);A!=="eraser"&&Math.random()<.7&&N(n,a,1),V(n,a)}function de(){F&&(F=!1,B())}function V(o,e){switch(A){case"kaleidoscope":te(o,e);break;case"symmetry":w(o,e);break;case"watercolor":oe(o,e);break;case"eraser":h(o,e);break}}window.addEventListener("scrollUp",()=>{D&&(p=(p-1+b.length)%b.length,q(p),J(-1)),X()});window.addEventListener("scrollDown",()=>{D&&(p=(p+1)%b.length,q(p),J(1)),X()});window.addEventListener("sideClick",()=>{if(D){const o=b[p];if(o.name==="llm"){ie(),C();return}else if(o.name==="palette"){const e=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#FE5F00","#FFFFFF"];v=e[Math.floor(Math.random()*e.length)],R(),C();return}else if(o.name==="text"){se(),C();return}q(p),C()}else le()});window.addEventListener("longPressStart",()=>{console.log("Long press started - showing toolbar"),X()});window.addEventListener("longPressEnd",()=>{console.log("Long press ended")});function he(){if(typeof window.creationSensors>"u"||!window.creationSensors.accelerometer){console.log("Accelerometer API not available");return}try{window.creationSensors.accelerometer.start(o=>{Y=o,f=Math.min(Math.max(Math.abs(o.z),.3),2)},{frequency:60}),console.log("Accelerometer started for painting app")}catch(o){console.error("Error starting accelerometer:",o)}}window.onPluginMessage=function(o){console.log("Received plugin message:",o),o.message&&fe(o.message)};function fe(o){const e=document.getElementById("adviceOverlay"),n=document.getElementById("adviceText");n.textContent=o,e.style.display="block",setTimeout(()=>{e.style.display="none"},5e3)}function K(){ne(),ae(),requestAnimationFrame(K)}document.addEventListener("DOMContentLoaded",()=>{console.log("Digital Painting App initialized!"),Q(),he(),s.addEventListener("mousedown",re),s.addEventListener("mousemove",ce),s.addEventListener("mouseup",de),s.addEventListener("touchstart",e=>{e.preventDefault();const n=e.touches[0],a=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});s.dispatchEvent(a)}),s.addEventListener("touchmove",e=>{e.preventDefault();const n=e.touches[0],a=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});s.dispatchEvent(a)}),s.addEventListener("touchend",e=>{e.preventDefault();const n=new MouseEvent("mouseup",{});s.dispatchEvent(n)}),document.getElementById("undoBtn").addEventListener("click",Z),document.getElementById("resetBtn").addEventListener("click",ee),document.querySelectorAll(".color-swatch").forEach(e=>{e.addEventListener("click",()=>{v=e.dataset.color,R()})}),R(),typeof PluginMessageHandler>"u"&&window.addEventListener("keydown",e=>{e.code==="Space"?(e.preventDefault(),window.dispatchEvent(new CustomEvent("sideClick"))):e.code==="ArrowUp"?(e.preventDefault(),window.dispatchEvent(new CustomEvent("scrollUp"))):e.code==="ArrowDown"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("scrollDown")))}),K(),console.log("Digital Painting App Ready!")});
